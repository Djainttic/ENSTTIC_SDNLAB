<!DOCTYPE html>
<html lang="en" class="light blue-theme">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ENSTIC SDN Lab Portal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@600;700&display=swap');
        
        :root {
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --text-primary: #334155;
            --text-secondary: #64748b;
            --text-headings: #0f172a;
            --border-color: #e2e8f0;
            --code-bg: #1e293b;
            --code-text: #e2e8f0;
            --accent-color: #004494;
            --accent-color-light: #e0f2fe;
            --accent-text-light: #0c4a6e;
        }

        html.blue-theme {
            --accent-color: #004494;
            --accent-color-light: #e0f2fe;
            --accent-text-light: #0c4a6e;
        }
        
        html.orange-theme {
            --accent-color: #f97316;
            --accent-color-light: #ffedd5;
            --accent-text-light: #9a3412;
        }
        
        html.dark {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --text-primary: #cbd5e1;
            --text-secondary: #94a3b8;
            --text-headings: #f1f5f9;
            --border-color: #334155;
            --code-bg: #020617;
            --code-text: #cbd5e1;
        }
        
        html.dark.blue-theme {
            --accent-color-light: #0c4a6e;
            --accent-text-light: #bae6fd;
        }

        html.dark.orange-theme {
            --accent-color-light: #7c2d12;
            --accent-text-light: #fed7aa;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: background-color 0.3s, color 0.3s;
        }
        
        .font-poppins { font-family: 'Poppins', sans-serif; }
        
        .prose h1, .prose h2, .prose h3, .prose h4 { 
            font-family: 'Poppins', sans-serif;
            color: var(--text-headings);
        }
        
        .prose h2, .prose h3, .prose h4 { color: var(--accent-color); }
        .prose a { color: var(--accent-color); font-weight: 500; }
        .prose code { background-color: var(--bg-tertiary); padding: 0.2em 0.4em; margin: 0; font-size: 85%; border-radius: 3px; color: var(--text-primary); }
        .prose pre { background-color: var(--code-bg); color: var(--code-text); padding: 1em; border-radius: 8px; overflow-x: auto; position: relative; }
        .prose pre code { background-color: transparent; padding: 0; margin: 0; color: inherit; font-size: inherit; }
        .prose ol, ul { padding-left: 1.5em; }
        .bg-secondary, .bg-card { background-color: var(--bg-secondary); }
        .border-custom { border-color: var(--border-color); }
        
        .copy-btn { 
            position: absolute; 
            top: 0.5rem; 
            right: 0.5rem; 
            background-color: #475569; 
            color: white; 
            padding: 0.25rem 0.5rem; 
            border-radius: 0.375rem; 
            font-size: 0.75rem; 
            cursor: pointer; 
            transition: background-color 0.2s; 
            border: none; 
        }
        
        .copy-btn:hover { background-color: #64748b; }
        
        .lab-title-container { 
            border-bottom: 1px solid var(--border-color); 
            padding-bottom: 0.75rem; 
            margin-bottom: 1.5rem; 
            display: flex; 
            flex-wrap: wrap; 
            justify-content: space-between; 
            align-items: center; 
            gap: 0.5rem; 
        }
        
        .lab-title-container h2 { margin-bottom: 0 !important; }
        
        .explain-btn { 
            background-color: var(--accent-color-light); 
            color: var(--accent-text-light); 
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s;
        }
        
        .explain-btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }
        
        #progress-bar { background-color: var(--accent-color); }
        #ai-modal { background-color: rgba(15, 23, 42, 0.7); }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .lab-status {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            font-weight: 500;
        }
        
        .status-complete {
            background-color: #dcfce7;
            color: #166534;
        }
        
        .status-in-progress {
            background-color: #fef3c7;
            color: #92400e;
        }
        
        .status-not-started {
            background-color: #f3f4f6;
            color: #6b7280;
        }
        
        .lab-duration {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.75rem;
            color: var(--text-secondary);
        }
        
        .search-highlight {
            background-color: #fef08a;
            padding: 0.1rem 0.2rem;
            border-radius: 0.25rem;
        }
        
        .concept-box {
            background-color: var(--accent-color-light);
            border-left: 4px solid var(--accent-color);
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-radius: 0 0.5rem 0.5rem 0;
        }
        
        .warning-box {
            background-color: #fef3c7;
            border-left: 4px solid #d97706;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-radius: 0 0.5rem 0.5rem 0;
        }
        
        .info-box {
            background-color: #dbeafe;
            border-left: 4px solid #3b82f6;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-radius: 0 0.5rem 0.5rem 0;
        }
        
        .advanced-tag {
            background: linear-gradient(135deg, #8b5cf6, #ec4899);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .research-tag {
            background: linear-gradient(135deg, #06b6d4, #10b981);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .tab-container {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
            white-space: nowrap;
        }
        
        .tab.active {
            border-bottom-color: var(--accent-color);
            color: var(--accent-color);
            font-weight: 600;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .topology-figure {
            width: 100%;
            max-width: 800px;
            margin: 1.5rem auto;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem;
            background-color: var(--bg-secondary);
        }
        
        .topology-svg {
            width: 100%;
            height: auto;
        }
        
        .node-host {
            fill: #3b82f6;
            stroke: #1d4ed8;
            stroke-width: 2;
        }
        
        .node-switch {
            fill: #10b981;
            stroke: #047857;
            stroke-width: 2;
        }
        
        .node-controller {
            fill: #f59e0b;
            stroke: #d97706;
            stroke-width: 2;
        }
        
        .node-router {
            fill: #8b5cf6;
            stroke: #7c3aed;
            stroke-width: 2;
        }
        
        .node-server {
            fill: #ef4444;
            stroke: #dc2626;
            stroke-width: 2;
        }
        
        .node-text {
            font-family: 'Inter', sans-serif;
            font-size: 12px;
            font-weight: 600;
            text-anchor: middle;
            fill: white;
        }
        
        .link-line {
            stroke: #64748b;
            stroke-width: 2;
            marker-end: url(#arrowhead);
        }
        
        .topology-caption {
            text-align: center;
            font-style: italic;
            margin-top: 0.5rem;
            color: var(--text-secondary);
        }
    </style>
</head>
<body class="antialiased">
    <!-- Progress Bar -->
    <div id="progress-bar-container" class="fixed top-0 left-0 w-full h-1 z-50">
        <div id="progress-bar" class="h-1 w-0 transition-all duration-150"></div>
    </div>

    <!-- Main Menu View -->
    <div id="main-menu" class="p-4 sm:p-6 md:p-8 min-h-screen flex flex-col">
        <header class="flex justify-between items-center mb-8">
            <div>
                <h1 class="text-3xl font-poppins font-bold" style="color: var(--accent-color);">
                    <i class="fas fa-network-wired mr-2"></i>ENSTIC SDN Lab Portal
                </h1>
                <p class="text-secondary mt-2">Software Defined Networking Laboratory Manual</p>
            </div>
            <div class="flex items-center space-x-2">
                <div class="relative group">
                    <button id="search-toggle" class="p-2 rounded-md hover:bg-slate-100 dark:hover:bg-slate-700">
                        <i class="fas fa-search"></i>
                    </button>
                    <div id="search-box" class="absolute right-0 top-full mt-2 hidden bg-secondary p-4 rounded-lg shadow-lg z-10 w-80">
                        <input type="text" id="search-input" placeholder="Search labs..." class="w-full p-2 border border-custom rounded">
                        <div id="search-results" class="mt-2 max-h-60 overflow-y-auto"></div>
                    </div>
                </div>
                <button id="theme-color-toggle" class="p-2 rounded-md hover:bg-slate-100 dark:hover:bg-slate-700">
                    <i class="fas fa-palette"></i>
                </button>
                <button id="theme-mode-toggle-main" class="p-2 rounded-md hover:bg-slate-100 dark:hover:bg-slate-700">
                    <i class="fas fa-sun" id="theme-mode-icon-main"></i>
                </button>
            </div>
        </header>
        
        <!-- Quick Stats -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
            <div class="bg-card p-4 rounded-lg border border-custom">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-blue-100 text-blue-600 mr-4">
                        <i class="fas fa-vial text-lg"></i>
                    </div>
                    <div>
                        <p class="text-sm text-secondary">Total Labs</p>
                        <p class="text-2xl font-bold" id="total-labs">0</p>
                    </div>
                </div>
            </div>
            <div class="bg-card p-4 rounded-lg border border-custom">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-green-100 text-green-600 mr-4">
                        <i class="fas fa-check-circle text-lg"></i>
                    </div>
                    <div>
                        <p class="text-sm text-secondary">Completed</p>
                        <p class="text-2xl font-bold" id="completed-labs">0</p>
                    </div>
                </div>
            </div>
            <div class="bg-card p-4 rounded-lg border border-custom">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-orange-100 text-orange-600 mr-4">
                        <i class="fas fa-clock text-lg"></i>
                    </div>
                    <div>
                        <p class="text-sm text-secondary">In Progress</p>
                        <p class="text-2xl font-bold" id="inprogress-labs">0</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="main-menu-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 flex-grow">
            <!-- Lab section cards will be populated here -->
        </div>
        
        <footer class="text-center text-sm text-secondary mt-8 pt-4 border-t border-custom">
            <p>&copy; 2024 National High School of Telecommunications and ICT (ENSTIC)</p>
            <p>Dr. Djalal ZIANI-KERARTI | dzianikerarti@inttic.dz</p>
        </footer>
    </div>

    <!-- Lab Viewer View -->
    <div id="lab-viewer" class="hidden">
        <main id="main-content" class="overflow-y-auto h-screen">
            <header class="sticky top-0 bg-secondary/80 backdrop-blur-md border-b border-custom p-4 shadow-sm z-10 flex items-center justify-between">
                <div class="flex items-center">
                    <button id="back-to-menu" class="flex items-center text-sm font-semibold hover:text-[--accent-color] transition-colors mr-4">
                        <i class="fas fa-arrow-left mr-2"></i>
                        Back to Menu
                    </button>
                    <h2 id="lab-viewer-title" class="text-lg font-poppins font-bold" style="color: var(--accent-color);"></h2>
                </div>
                <div class="flex items-center space-x-2">
                    <button id="prev-lab" class="p-2 rounded-md hover:bg-slate-100 dark:hover:bg-slate-700">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <button id="next-lab" class="p-2 rounded-md hover:bg-slate-100 dark:hover:bg-slate-700">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                    <button id="theme-mode-toggle-viewer" class="p-2 rounded-md hover:bg-slate-100 dark:hover:bg-slate-700">
                        <i class="fas fa-sun" id="theme-mode-icon-viewer"></i>
                    </button>
                </div>
            </header>
            <div id="content-container" class="p-4 sm:p-6 md:p-8">
                <!-- Lab Content will be dynamically populated here -->
            </div>
        </main>
    </div>

    <!-- AI Explanation Modal -->
    <div id="ai-modal" class="fixed inset-0 z-50 flex items-center justify-center hidden">
        <div class="bg-secondary rounded-lg shadow-xl p-6 m-4 max-w-2xl w-full max-h-[80vh] flex flex-col">
            <div class="flex justify-between items-center border-b border-custom pb-3">
                <h3 id="modal-title" class="text-xl font-bold font-poppins flex items-center">
                    <i class="fas fa-robot mr-2"></i>Explanation
                </h3>
                <button id="close-modal-btn" class="p-1 rounded-full hover:bg-slate-200 dark:hover:bg-slate-600">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="modal-content" class="prose dark:prose-invert max-w-none mt-4 overflow-y-auto"></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Enhanced labs data structure with additional metadata
            const labsData = {
                "sec1": {
                    section: "Section 1: Fundamental Concepts",
                    icon: "fas fa-cogs",
                    description: "Introduction to SDN environment and basic tools",
                    labs: [ 
                        { 
                            id: 'lab1-1', 
                            title: '1.1 Environment Setup (Mininet/Ryu)',
                            duration: '30 min',
                            difficulty: 'Beginner',
                            status: 'not-started'
                        },
                        { 
                            id: 'lab1-2', 
                            title: '1.2 Introduction to Mininet',
                            duration: '45 min',
                            difficulty: 'Beginner',
                            status: 'not-started'
                        },
                        { 
                            id: 'lab1-3', 
                            title: '1.3 Using Open vSwitch',
                            duration: '60 min',
                            difficulty: 'Intermediate',
                            status: 'not-started'
                        }
                    ]
                },
                "sec2": {
                    section: "Section 2: Topology Creation",
                    icon: "fas fa-project-diagram",
                    description: "Creating network topologies with Mininet",
                    labs: [ 
                        { 
                            id: 'lab2-1', 
                            title: '2.1 Topology with MiniEdit',
                            duration: '30 min',
                            difficulty: 'Beginner',
                            status: 'not-started'
                        },
                        { 
                            id: 'lab2-2', 
                            title: '2.2 Script: myFirstTopo.py',
                            duration: '45 min',
                            difficulty: 'Intermediate',
                            status: 'not-started'
                        },
                        { 
                            id: 'lab2-3', 
                            title: '2.3 Script: Routed Network (Theory)',
                            duration: '30 min',
                            difficulty: 'Intermediate',
                            status: 'not-started'
                        },
                        { 
                            id: 'lab2-4', 
                            title: '2.4 Script: Advanced Routed Network',
                            duration: '60 min',
                            difficulty: 'Advanced',
                            status: 'not-started'
                        }
                    ]
                },
                "sec3": {
                    section: "Section 3: Ryu Applications",
                    icon: "fas fa-code",
                    description: "Developing SDN applications with Ryu controller",
                    labs: [ 
                        { 
                            id: 'lab3-intro', 
                            title: 'Introduction & Topology',
                            duration: '20 min',
                            difficulty: 'Beginner',
                            status: 'not-started'
                        },
                        { 
                            id: 'lab3-1', 
                            title: '3.1 L2 Switch (Reactive)',
                            duration: '60 min',
                            difficulty: 'Intermediate',
                            status: 'not-started'
                        },
                        { 
                            id: 'lab3-2', 
                            title: '3.2 L3 Switch (IP Matching)',
                            duration: '75 min',
                            difficulty: 'Intermediate',
                            status: 'not-started'
                        },
                        { 
                            id: 'lab3-3', 
                            title: '3.3 L4 Switch (Port Matching)',
                            duration: '90 min',
                            difficulty: 'Advanced',
                            status: 'not-started'
                        }
                    ]
                },
                "sec4": {
                    section: "Section 4: Traffic Analysis",
                    icon: "fas fa-chart-bar",
                    description: "Monitoring and analyzing network traffic",
                    labs: [ 
                        { 
                            id: 'lab4-1', 
                            title: '4.1 Inspection: OpenFlow Handshake',
                            duration: '45 min',
                            difficulty: 'Intermediate',
                            status: 'not-started'
                        },
                        { 
                            id: 'lab4-2', 
                            title: '4.2 Visualization: Flow Manager',
                            duration: '30 min',
                            difficulty: 'Beginner',
                            status: 'not-started'
                        },
                        { 
                            id: 'lab4-4', 
                            title: '4.4 Monitoring: Flow & Port Statistics',
                            duration: '60 min',
                            difficulty: 'Intermediate',
                            status: 'not-started'
                        }
                    ]
                },
                "sec4-other": {
                    section: "Section 4: Optional: Other Controllers",
                    icon: "fas fa-server",
                    description: "Working with alternative SDN controllers",
                    labs: [ 
                        { 
                            id: 'lab4-3', 
                            title: '4.3 HPE VAN SDN Controller Setup',
                            duration: '45 min',
                            difficulty: 'Intermediate',
                            status: 'not-started'
                        }
                    ]
                },
                "sec5": {
                    section: "Section 5: Advanced Applications",
                    icon: "fas fa-rocket",
                    description: "Implementing advanced SDN applications",
                    labs: [ 
                        { 
                            id: 'lab5-1', 
                            title: '5.1 Load Balancer (Proactive)',
                            duration: '90 min',
                            difficulty: 'Advanced',
                            status: 'not-started'
                        },
                        { 
                            id: 'lab5-2', 
                            title: '5.2 MPLS (Push, Swap, Pop)',
                            duration: '75 min',
                            difficulty: 'Advanced',
                            status: 'not-started'
                        },
                        { 
                            id: 'lab5-3', 
                            title: '5.3 ARP Proxy & Spoofing Mitigation',
                            duration: '60 min',
                            difficulty: 'Intermediate',
                            status: 'not-started'
                        },
                        { 
                            id: 'lab5-4', 
                            title: '5.4 Security: ICMP Flood',
                            duration: '60 min',
                            difficulty: 'Intermediate',
                            status: 'not-started'
                        },
                        { 
                            id: 'lab5-5', 
                            title: '5.5 Topology Discovery (LLDP)',
                            duration: '45 min',
                            difficulty: 'Intermediate',
                            status: 'not-started'
                        },
                        { 
                            id: 'lab5-6', 
                            title: '5.6 High Availability (Multi-Controller)',
                            duration: '60 min',
                            difficulty: 'Advanced',
                            status: 'not-started'
                        }
                    ]
                },
                "sec6": {
                    section: "Section 6: Advanced Demos & Projects",
                    icon: "fas fa-flask",
                    description: "Complex SDN projects and demonstrations",
                    labs: [ 
                        { 
                            id: 'lab6-1', 
                            title: '6.1 Flow Timeouts & Controller Failure',
                            duration: '45 min',
                            difficulty: 'Intermediate',
                            status: 'not-started'
                        },
                        { 
                            id: 'lab6-2', 
                            title: '6.2 Proactive Traffic Engineering',
                            duration: '60 min',
                            difficulty: 'Advanced',
                            status: 'not-started'
                        },
                        { 
                            id: 'lab6-3', 
                            title: '6.3 Project: Load Balancer V2 (3 Paths)',
                            duration: '90 min',
                            difficulty: 'Advanced',
                            status: 'not-started'
                        },
                        { 
                            id: 'lab6-4', 
                            title: '6.4 Project: Firewall',
                            duration: '75 min',
                            difficulty: 'Advanced',
                            status: 'not-started'
                        }
                    ]
                },
                "sec7": {
                    section: "Section 7: Research & Advanced Topics",
                    icon: "fas fa-microscope",
                    description: "Cutting-edge SDN research and advanced implementations",
                    labs: [ 
                        { 
                            id: 'lab7-1', 
                            title: '7.1 Network Function Virtualization (NFV)',
                            duration: '90 min',
                            difficulty: 'Advanced',
                            status: 'not-started',
                            tags: ['research']
                        },
                        { 
                            id: 'lab7-2', 
                            title: '7.2 P4 Programming',
                            duration: '120 min',
                            difficulty: 'Advanced',
                            status: 'not-started',
                            tags: ['research', 'advanced']
                        },
                        { 
                            id: 'lab7-3', 
                            title: '7.3 Intent-Based Networking',
                            duration: '75 min',
                            difficulty: 'Advanced',
                            status: 'not-started',
                            tags: ['research']
                        },
                        { 
                            id: 'lab7-4', 
                            title: '7.4 Machine Learning for Traffic Classification',
                            duration: '90 min',
                            difficulty: 'Advanced',
                            status: 'not-started',
                            tags: ['research', 'advanced']
                        },
                        { 
                            id: 'lab7-5', 
                            title: '7.5 SD-WAN Implementation',
                            duration: '60 min',
                            difficulty: 'Advanced',
                            status: 'not-started',
                            tags: ['advanced']
                        },
                        { 
                            id: 'lab7-6', 
                            title: '7.6 Time-Sensitive Networking (TSN)',
                            duration: '75 min',
                            difficulty: 'Advanced',
                            status: 'not-started',
                            tags: ['research', 'advanced']
                        }
                    ]
                }
            };
            
            // DOM Elements
            const mainMenu = document.getElementById('main-menu');
            const labViewer = document.getElementById('lab-viewer');
            const mainMenuGrid = document.getElementById('main-menu-grid');
            const contentContainer = document.getElementById('content-container');
            const backToMenuBtn = document.getElementById('back-to-menu');
            const labViewerTitle = document.getElementById('lab-viewer-title');
            const prevLabBtn = document.getElementById('prev-lab');
            const nextLabBtn = document.getElementById('next-lab');
            const mainContent = document.getElementById('main-content');
            const progressBar = document.getElementById('progress-bar');
            const aiModal = document.getElementById('ai-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalContent = document.getElementById('modal-content');
            const closeModalBtn = document.getElementById('close-modal-btn');
            const searchToggle = document.getElementById('search-toggle');
            const searchBox = document.getElementById('search-box');
            const searchInput = document.getElementById('search-input');
            const searchResults = document.getElementById('search-results');
            const totalLabsEl = document.getElementById('total-labs');
            const completedLabsEl = document.getElementById('completed-labs');
            const inprogressLabsEl = document.getElementById('inprogress-labs');
            
            // State variables
            let currentSectionId = null;
            let currentLabIndex = 0;
            let allLabs = [];
            
            // Initialize the application
            function init() {
                populateMainMenu();
                setupEventListeners();
                updateStats();
                loadUserProgress();
            }
            
            // Populate the main menu with section cards
            function populateMainMenu() {
                mainMenuGrid.innerHTML = '';
                allLabs = [];
                
                Object.keys(labsData).forEach(sectionId => {
                    const section = labsData[sectionId];
                    const card = document.createElement('div');
                    card.className = 'bg-card p-6 rounded-lg shadow-md border border-custom card-hover cursor-pointer';
                    
                    // Highlight optional section
                    if (sectionId === 'sec4-other') {
                        card.classList.add('border-orange-400', 'border-2', 'bg-yellow-50', 'dark:bg-slate-800');
                    }
                    
                    // Highlight research section
                    if (sectionId === 'sec7') {
                        card.classList.add('border-purple-400', 'border-2');
                    }
                    
                    card.dataset.sectionId = sectionId;
                    
                    // Build lab list with status indicators
                    let labsList = '';
                    section.labs.forEach((lab, index) => {
                        allLabs.push({...lab, sectionId, sectionName: section.section, index});
                        const statusClass = `status-${lab.status}`;
                        
                        // Add tags if present
                        let tagsHTML = '';
                        if (lab.tags) {
                            lab.tags.forEach(tag => {
                                if (tag === 'advanced') {
                                    tagsHTML += `<span class="advanced-tag ml-2"><i class="fas fa-bolt"></i> Advanced</span>`;
                                }
                                if (tag === 'research') {
                                    tagsHTML += `<span class="research-tag ml-2"><i class="fas fa-flask"></i> Research</span>`;
                                }
                            });
                        }
                        
                        labsList += `
                            <li class="flex items-center justify-between py-1">
                                <div class="flex items-center">
                                    <span>${lab.title}</span>
                                    ${tagsHTML}
                                </div>
                                <span class="${statusClass} lab-status">
                                    <i class="fas fa-${getStatusIcon(lab.status)}"></i>
                                </span>
                            </li>
                        `;
                    });
                    
                    card.innerHTML = `
                        <div class="flex items-start mb-4">
                            <div class="p-3 rounded-full bg-[--accent-color-light] text-[--accent-color] mr-4">
                                <i class="${section.icon}"></i>
                            </div>
                            <div>
                                <h2 class="font-poppins text-xl font-bold mb-1" style="color: var(--accent-color);">${section.section}</h2>
                                <p class="text-sm text-secondary">${section.description}</p>
                            </div>
                        </div>
                        <ul class="text-sm text-secondary space-y-1">
                            ${labsList}
                        </ul>
                        <div class="mt-4 pt-3 border-t border-custom text-xs text-secondary flex justify-between">
                            <span>${section.labs.length} labs</span>
                            <span class="lab-duration">
                                <i class="fas fa-clock"></i>
                                ${calculateTotalDuration(section.labs)}
                            </span>
                        </div>
                    `;
                    
                    mainMenuGrid.appendChild(card);
                });
            }
            
            // Calculate total duration for a section
            function calculateTotalDuration(labs) {
                const totalMinutes = labs.reduce((total, lab) => {
                    const minutes = parseInt(lab.duration);
                    return total + (isNaN(minutes) ? 0 : minutes);
                }, 0);
                
                if (totalMinutes < 60) return `${totalMinutes} min`;
                const hours = Math.floor(totalMinutes / 60);
                const minutes = totalMinutes % 60;
                return minutes > 0 ? `${hours}h ${minutes}m` : `${hours}h`;
            }
            
            // Get status icon based on status
            function getStatusIcon(status) {
                switch(status) {
                    case 'complete': return 'check-circle';
                    case 'in-progress': return 'spinner';
                    default: return 'circle';
                }
            }
            
            // Update statistics
            function updateStats() {
                let total = 0;
                let completed = 0;
                let inProgress = 0;
                
                Object.keys(labsData).forEach(sectionId => {
                    const section = labsData[sectionId];
                    total += section.labs.length;
                    
                    section.labs.forEach(lab => {
                        if (lab.status === 'complete') completed++;
                        if (lab.status === 'in-progress') inProgress++;
                    });
                });
                
                totalLabsEl.textContent = total;
                completedLabsEl.textContent = completed;
                inprogressLabsEl.textContent = inProgress;
            }
            
            // Load user progress from localStorage
            function loadUserProgress() {
                const savedProgress = localStorage.getItem('sdn-lab-progress');
                if (savedProgress) {
                    const progress = JSON.parse(savedProgress);
                    
                    Object.keys(labsData).forEach(sectionId => {
                        if (progress[sectionId]) {
                            labsData[sectionId].labs.forEach((lab, index) => {
                                if (progress[sectionId][lab.id]) {
                                    lab.status = progress[sectionId][lab.id];
                                }
                            });
                        }
                    });
                    
                    populateMainMenu();
                    updateStats();
                }
            }
            
            // Save user progress to localStorage
            function saveUserProgress() {
                const progress = {};
                
                Object.keys(labsData).forEach(sectionId => {
                    progress[sectionId] = {};
                    labsData[sectionId].labs.forEach(lab => {
                        progress[sectionId][lab.id] = lab.status;
                    });
                });
                
                localStorage.setItem('sdn-lab-progress', JSON.stringify(progress));
                updateStats();
            }
            
            // Show main menu
            function showMainMenu() {
                mainMenu.style.display = 'flex';
                labViewer.style.display = 'none';
                searchBox.classList.add('hidden');
            }
            
            // Show lab viewer
            function showLabView(sectionId, labIndex = 0) {
                currentSectionId = sectionId;
                currentLabIndex = labIndex;
                
                mainMenu.style.display = 'none';
                labViewer.style.display = 'block';
                
                const section = labsData[sectionId];
                labViewerTitle.textContent = section.section;
                
                renderLabContent(sectionId, labIndex);
                updateNavigationButtons();
                mainContent.scrollTop = 0;
            }
            
            // Render lab content
            function renderLabContent(sectionId, labIndex) {
                const section = labsData[sectionId];
                const lab = section.labs[labIndex];
                
                let contentHtml = `
                    <div id="${lab.id}" class="prose dark:prose-invert max-w-none mb-12">
                        <div class="lab-title-container">
                            <div>
                                <h2 class="font-poppins">${lab.title}</h2>
                                <div class="flex items-center mt-2 space-x-4">
                                    <span class="lab-duration">
                                        <i class="fas fa-clock"></i> ${lab.duration}
                                    </span>
                                    <span class="px-2 py-1 rounded-full text-xs font-medium bg-gray-100 dark:bg-gray-700">
                                        ${lab.difficulty}
                                    </span>
                                    ${lab.tags && lab.tags.includes('advanced') ? '<span class="advanced-tag"><i class="fas fa-bolt"></i> Advanced</span>' : ''}
                                    ${lab.tags && lab.tags.includes('research') ? '<span class="research-tag"><i class="fas fa-flask"></i> Research</span>' : ''}
                                    <div class="flex items-center space-x-2">
                                        <span>Status:</span>
                                        <select class="status-select text-sm border border-custom rounded p-1 bg-transparent" data-lab-id="${lab.id}">
                                            <option value="not-started" ${lab.status === 'not-started' ? 'selected' : ''}>Not Started</option>
                                            <option value="in-progress" ${lab.status === 'in-progress' ? 'selected' : ''}>In Progress</option>
                                            <option value="complete" ${lab.status === 'complete' ? 'selected' : ''}>Complete</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <button class="explain-btn" data-lab-id="${lab.id}">
                                <i class="fas fa-robot"></i> Explain
                            </button>
                        </div>
                        <div>${getLabContent(lab.id)}</div>
                    </div>
                `;
                
                contentContainer.innerHTML = contentHtml;
                addCopyButtonFunctionality();
                addExplainButtonFunctionality();
                addStatusChangeListener();
                addTabFunctionality();
                updateProgressBar();
            }
            
            // Update navigation buttons state
            function updateNavigationButtons() {
                const section = labsData[currentSectionId];
                prevLabBtn.disabled = currentLabIndex === 0;
                nextLabBtn.disabled = currentLabIndex === section.labs.length - 1;
            }
            
            // Add status change listener
            function addStatusChangeListener() {
                const statusSelect = document.querySelector('.status-select');
                if (statusSelect) {
                    statusSelect.addEventListener('change', function() {
                        const labId = this.dataset.labId;
                        const newStatus = this.value;
                        
                        // Update the lab status
                        labsData[currentSectionId].labs[currentLabIndex].status = newStatus;
                        
                        // Save to localStorage
                        saveUserProgress();
                        
                        // Update the main menu if we're going back
                        populateMainMenu();
                    });
                }
            }
            
            // Add tab functionality
            function addTabFunctionality() {
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.addEventListener('click', function() {
                        const tabName = this.dataset.tab;
                        const container = this.closest('.tab-container');
                        
                        // Remove active class from all tabs and contents
                        container.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                        container.parentElement.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                        
                        // Add active class to clicked tab and corresponding content
                        this.classList.add('active');
                        container.parentElement.querySelector(`.tab-content[data-tab="${tabName}"]`).classList.add('active');
                    });
                });
            }
            
            // Add copy button functionality to code blocks
            function addCopyButtonFunctionality() {
                contentContainer.querySelectorAll('pre').forEach(pre => {
                    const code = pre.querySelector('code');
                    if (code && !pre.querySelector('.copy-btn')) {
                        const copyBtn = document.createElement('button');
                        copyBtn.className = 'copy-btn';
                        copyBtn.innerHTML = '<i class="fas fa-copy mr-1"></i> Copy';
                        pre.appendChild(copyBtn);
                        
                        copyBtn.addEventListener('click', () => {
                            navigator.clipboard.writeText(code.innerText).then(() => {
                                copyBtn.innerHTML = '<i class="fas fa-check mr-1"></i> Copied!';
                                setTimeout(() => { 
                                    copyBtn.innerHTML = '<i class="fas fa-copy mr-1"></i> Copy'; 
                                }, 2000);
                            });
                        });
                    }
                });
            }
            
            // Add explain button functionality
            function addExplainButtonFunctionality() {
                contentContainer.querySelectorAll('.explain-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const labId = e.currentTarget.dataset.labId;
                        let conceptTitle = '';
                        
                        for (const sectionKey in labsData) {
                            const section = labsData[sectionKey];
                            const lab = section.labs.find(l => l.id === labId);
                            if (lab) {
                                conceptTitle = lab.title;
                                break;
                            }
                        }
                        
                        if (conceptTitle) {
                            handleExplainClick(labId, conceptTitle);
                        }
                    });
                });
            }
            
            // Handle explain button click
            function handleExplainClick(labId, conceptTitle) {
                const explanation = getExplanation(labId);
                modalTitle.textContent = `Explanation: ${conceptTitle}`;
                modalContent.innerHTML = explanation.replace(/\n/g, '<br>');
                aiModal.style.display = 'flex';
            }
            
            // Update progress bar based on scroll
            function updateProgressBar() {
                const scrollableHeight = mainContent.scrollHeight - mainContent.clientHeight;
                const scrollTop = mainContent.scrollTop;
                const progress = scrollableHeight > 0 ? (scrollTop / scrollableHeight) * 100 : 0;
                progressBar.style.width = `${progress}%`;
            }
            
            // Setup event listeners
            function setupEventListeners() {
                // Main menu grid click
                mainMenuGrid.addEventListener('click', (e) => {
                    const card = e.target.closest('div[data-section-id]');
                    if (card) {
                        showLabView(card.dataset.sectionId);
                    }
                });
                
                // Back to menu button
                backToMenuBtn.addEventListener('click', showMainMenu);
                
                // Navigation buttons
                prevLabBtn.addEventListener('click', () => {
                    if (currentLabIndex > 0) {
                        showLabView(currentSectionId, currentLabIndex - 1);
                    }
                });
                
                nextLabBtn.addEventListener('click', () => {
                    const section = labsData[currentSectionId];
                    if (currentLabIndex < section.labs.length - 1) {
                        showLabView(currentSectionId, currentLabIndex + 1);
                    }
                });
                
                // Scroll event for progress bar
                mainContent.addEventListener('scroll', updateProgressBar);
                
                // Modal close
                closeModalBtn.addEventListener('click', () => { aiModal.style.display = 'none'; });
                aiModal.addEventListener('click', (e) => { 
                    if (e.target === aiModal) { 
                        aiModal.style.display = 'none'; 
                    } 
                });
                
                // Theme toggles
                const themeModeToggles = [ 
                    document.getElementById('theme-mode-toggle-main'), 
                    document.getElementById('theme-mode-toggle-viewer') 
                ];
                
                const themeColorToggle = document.getElementById('theme-color-toggle');
                
                // Apply dark mode
                const applyDarkMode = (isDark) => {
                    if (isDark) {
                        document.documentElement.classList.add('dark');
                        document.querySelectorAll('#theme-mode-icon-main, #theme-mode-icon-viewer').forEach(icon => {
                            icon.className = 'fas fa-moon';
                        });
                    } else {
                        document.documentElement.classList.remove('dark');
                        document.querySelectorAll('#theme-mode-icon-main, #theme-mode-icon-viewer').forEach(icon => {
                            icon.className = 'fas fa-sun';
                        });
                    }
                };
                
                // Apply color theme
                const applyColorTheme = (color) => {
                    document.documentElement.classList.remove('blue-theme', 'orange-theme');
                    document.documentElement.classList.add(color + '-theme');
                };
                
                // Theme mode toggle
                themeModeToggles.forEach(btn => btn.addEventListener('click', () => {
                    const isDark = !document.documentElement.classList.contains('dark');
                    localStorage.setItem('themeMode', isDark ? 'dark' : 'light');
                    applyDarkMode(isDark);
                }));
                
                // Theme color toggle
                themeColorToggle.addEventListener('click', () => {
                    const currentColor = localStorage.getItem('themeColor') || 'blue';
                    const newColor = currentColor === 'blue' ? 'orange' : 'blue';
                    localStorage.setItem('themeColor', newColor);
                    applyColorTheme(newColor);
                });
                
                // Apply saved themes
                applyDarkMode(localStorage.getItem('themeMode') === 'dark');
                applyColorTheme(localStorage.getItem('themeColor') || 'blue');
                
                // Search functionality
                searchToggle.addEventListener('click', () => {
                    searchBox.classList.toggle('hidden');
                    if (!searchBox.classList.contains('hidden')) {
                        searchInput.focus();
                    }
                });
                
                searchInput.addEventListener('input', (e) => {
                    const query = e.target.value.toLowerCase().trim();
                    
                    if (query.length < 2) {
                        searchResults.innerHTML = '';
                        return;
                    }
                    
                    const results = allLabs.filter(lab => 
                        lab.title.toLowerCase().includes(query) || 
                        lab.sectionName.toLowerCase().includes(query)
                    );
                    
                    displaySearchResults(results, query);
                });
                
                // Close search when clicking outside
                document.addEventListener('click', (e) => {
                    if (!searchToggle.contains(e.target) && !searchBox.contains(e.target)) {
                        searchBox.classList.add('hidden');
                    }
                });
            }
            
            // Display search results
            function displaySearchResults(results, query) {
                if (results.length === 0) {
                    searchResults.innerHTML = '<p class="text-sm text-secondary p-2">No labs found</p>';
                    return;
                }
                
                let resultsHTML = '';
                results.forEach(lab => {
                    const highlightedTitle = lab.title.replace(
                        new RegExp(query, 'gi'), 
                        match => `<span class="search-highlight">${match}</span>`
                    );
                    
                    const highlightedSection = lab.sectionName.replace(
                        new RegExp(query, 'gi'), 
                        match => `<span class="search-highlight">${match}</span>`
                    );
                    
                    resultsHTML += `
                        <div class="p-2 border-b border-custom last:border-b-0 hover:bg-slate-100 dark:hover:bg-slate-700 cursor-pointer search-result" 
                             data-section-id="${lab.sectionId}" data-lab-index="${lab.index}">
                            <div class="font-medium">${highlightedTitle}</div>
                            <div class="text-xs text-secondary">${highlightedSection}</div>
                        </div>
                    `;
                });
                
                searchResults.innerHTML = resultsHTML;
                
                // Add click event to search results
                document.querySelectorAll('.search-result').forEach(result => {
                    result.addEventListener('click', () => {
                        const sectionId = result.dataset.sectionId;
                        const labIndex = parseInt(result.dataset.labIndex);
                        showLabView(sectionId, labIndex);
                        searchBox.classList.add('hidden');
                        searchInput.value = '';
                    });
                });
            }
            
            // Get lab content
            function getLabContent(labId) {
                const contentData = {
                    'lab1-1': `
                        <div class="tab-container">
                            <div class="tab active" data-tab="overview">Overview</div>
                            <div class="tab" data-tab="steps">Step-by-Step</div>
                            <div class="tab" data-tab="troubleshooting">Troubleshooting</div>
                        </div>
                        
                        <div class="tab-content active" data-tab="overview">
                            <h3>Objective</h3>
                            <p>To set up a unified laboratory environment on a single virtual machine that hosts both the Mininet network emulator and the Ryu SDN controller.</p>
                            
                            <div class="topology-figure">
                                <svg class="topology-svg" viewBox="0 0 800 400" xmlns="http://www.w3.org/2000/svg">
                                    <defs>
                                        <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                            <polygon points="0 0, 10 3.5, 0 7" fill="#64748b"/>
                                        </marker>
                                    </defs>
                                    
                                    <!-- Hosts -->
                                    <rect x="100" y="150" width="80" height="60" rx="5" class="node-host"/>
                                    <text x="140" y="185" class="node-text">h1</text>
                                    <rect x="100" y="250" width="80" height="60" rx="5" class="node-host"/>
                                    <text x="140" y="285" class="node-text">h2</text>
                                    
                                    <!-- Switch -->
                                    <rect x="300" y="180" width="100" height="100" rx="10" class="node-switch"/>
                                    <text x="350" y="240" class="node-text">s1</text>
                                    
                                    <!-- Controller -->
                                    <rect x="550" y="180" width="100" height="100" rx="10" class="node-controller"/>
                                    <text x="600" y="240" class="node-text">Ryu</text>
                                    
                                    <!-- Links -->
                                    <line x1="180" y1="180" x2="300" y2="230" class="link-line"/>
                                    <line x1="180" y1="280" x2="300" y2="230" class="link-line"/>
                                    <line x1="400" y1="230" x2="550" y2="230" class="link-line" stroke-dasharray="5,5"/>
                                    
                                    <!-- Labels -->
                                    <text x="240" y="170" text-anchor="middle" font-family="Inter" font-size="14" fill="#64748b">Mininet</text>
                                    <text x="475" y="170" text-anchor="middle" font-family="Inter" font-size="14" fill="#64748b">OpenFlow</text>
                                    <text x="600" y="150" text-anchor="middle" font-family="Inter" font-size="14" fill="#64748b">SDN Controller</text>
                                </svg>
                                <div class="topology-caption">Figure 1.1: Basic SDN test environment with Mininet and Ryu controller</div>
                            </div>
                            
                            <div class="concept-box">
                                <h4><i class="fas fa-lightbulb mr-2"></i>Key Concept: Virtualization</h4>
                                <p>Virtualization allows running multiple operating systems on a single physical machine. In this lab, we use a pre-configured VM containing all necessary SDN tools, which simplifies setup and ensures consistency across different hardware configurations.</p>
                            </div>
                            
                            <h3>Architecture Overview</h3>
                            <p>The lab environment consists of:</p>
                            <ul>
                                <li><strong>Mininet:</strong> Network emulator that creates virtual networks</li>
                                <li><strong>Ryu Controller:</strong> SDN controller written in Python</li>
                                <li><strong>Open vSwitch:</strong> Software switch implementation</li>
                                <li><strong>Wireshark:</strong> Network protocol analyzer</li>
                            </ul>
                            
                            <div class="info-box">
                                <h4><i class="fas fa-info-circle mr-2"></i>Prerequisites</h4>
                                <ul>
                                    <li>VirtualBox or VMware Player installed</li>
                                    <li>At least 4GB RAM available for the VM</li>
                                    <li>Basic familiarity with Linux command line</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="tab-content" data-tab="steps">
                            <h3>Step-by-Step Instructions</h3>
                            
                            <h4>1. Download and Import VM</h4>
                            <ol>
                                <li>Download the SDN VM image from the provided link</li>
                                <li>Open VirtualBox and select <strong>File → Import Appliance</strong></li>
                                <li>Browse to the downloaded .ova file and click <strong>Next</strong></li>
                                <li>Adjust settings if needed (recommended: 2+ GB RAM, 2+ CPU cores)</li>
                                <li>Click <strong>Import</strong> and wait for the process to complete</li>
                            </ol>
                            
                            <h4>2. First Boot and Verification</h4>
                            <ol>
                                <li>Start the imported VM</li>
                                <li>Login with credentials: <code>mininet</code> / <code>mininet</code></li>
                                <li>Open a terminal and verify installations:
                                    <pre><code># Check Mininet installation
sudo mn --version

# Check Ryu installation  
ryu-manager --version

# Check Open vSwitch
ovs-vsctl --version</code></pre>
                                </li>
                            </ol>
                            
                            <h4>3. Basic Connectivity Test</h4>
                            <ol>
                                <li>In Terminal 1, start Ryu controller:
                                    <pre><code>ryu-manager ryu.app.simple_switch_13</code></pre>
                                </li>
                                <li>In Terminal 2, start Mininet with remote controller:
                                    <pre><code>sudo mn --controller=remote,ip=127.0.0.1 --switch ovsk,protocols=OpenFlow13</code></pre>
                                </li>
                                <li>In the Mininet CLI, test connectivity:
                                    <pre><code>mininet> pingall</code></pre>
                                </li>
                                <li>If all pings succeed, your environment is correctly configured</li>
                            </ol>
                        </div>
                        
                        <div class="tab-content" data-tab="troubleshooting">
                            <h3>Common Issues and Solutions</h3>
                            
                            <div class="warning-box">
                                <h4><i class="fas fa-exclamation-triangle mr-2"></i>Virtualization Not Enabled</h4>
                                <p><strong>Symptoms:</strong> VM fails to start or runs extremely slow</p>
                                <p><strong>Solution:</strong> Enable virtualization in BIOS/UEFI settings (usually under CPU configuration)</p>
                            </div>
                            
                            <div class="warning-box">
                                <h4><i class="fas fa-exclamation-triangle mr-2"></i>Controller Connection Refused</h4>
                                <p><strong>Symptoms:</strong> Mininet shows "Unable to connect to controller"</p>
                                <p><strong>Solution:</strong> Ensure Ryu controller is running before starting Mininet. Check firewall settings.</p>
                            </div>
                            
                            <div class="warning-box">
                                <h4><i class="fas fa-exclamation-triangle mr-2"></i>Permission Denied Errors</h4>
                                <p><strong>Symptoms:</strong> "sudo: unable to resolve host" or permission errors</p>
                                <p><strong>Solution:</strong> This is usually harmless. If commands fail, try <code>sudo -s</code> to get a root shell.</p>
                            </div>
                        </div>
                        
                        <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg mt-6">
                            <h4 class="flex items-center text-blue-800 dark:text-blue-200">
                                <i class="fas fa-lightbulb mr-2"></i> Advanced Tip
                            </h4>
                            <p class="text-blue-700 dark:text-blue-300">For better performance, consider allocating more RAM to the VM (4GB recommended) and enabling hardware acceleration in your virtualization software settings.</p>
                        </div>
                    `,
                    
                    'lab2-2': `
                        <div class="tab-container">
                            <div class="tab active" data-tab="overview">Overview</div>
                            <div class="tab" data-tab="implementation">Implementation</div>
                            <div class="tab" data-tab="testing">Testing</div>
                        </div>
                        
                        <div class="tab-content active" data-tab="overview">
                            <h3>Objective</h3>
                            <p>Create a custom network topology using Mininet's Python API with two switches and four hosts in a specific configuration.</p>
                            
                            <div class="topology-figure">
                                <svg class="topology-svg" viewBox="0 0 800 500" xmlns="http://www.w3.org/2000/svg">
                                    <defs>
                                        <marker id="arrowhead2" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                            <polygon points="0 0, 10 3.5, 0 7" fill="#64748b"/>
                                        </marker>
                                    </defs>
                                    
                                    <!-- Hosts -->
                                    <rect x="100" y="100" width="80" height="60" rx="5" class="node-host"/>
                                    <text x="140" y="135" class="node-text">h1</text>
                                    <rect x="100" y="200" width="80" height="60" rx="5" class="node-host"/>
                                    <text x="140" y="235" class="node-text">h2</text>
                                    <rect x="600" y="100" width="80" height="60" rx="5" class="node-host"/>
                                    <text x="640" y="135" class="node-text">h3</text>
                                    <rect x="600" y="200" width="80" height="60" rx="5" class="node-host"/>
                                    <text x="640" y="235" class="node-text">h4</text>
                                    
                                    <!-- Switches -->
                                    <rect x="250" y="80" width="100" height="100" rx="10" class="node-switch"/>
                                    <text x="300" y="140" class="node-text">s1</text>
                                    <rect x="450" y="80" width="100" height="100" rx="10" class="node-switch"/>
                                    <text x="500" y="140" class="node-text">s2</text>
                                    
                                    <!-- Links -->
                                    <line x1="180" y1="130" x2="250" y2="130" class="link-line"/>
                                    <line x1="180" y1="230" x2="250" y2="130" class="link-line"/>
                                    <line x1="350" y1="130" x2="450" y2="130" class="link-line"/>
                                    <line x1="550" y1="130" x2="600" y2="130" class="link-line"/>
                                    <line x1="550" y1="130" x2="600" y2="230" class="link-line"/>
                                    
                                    <!-- Labels -->
                                    <text x="300" y="50" text-anchor="middle" font-family="Inter" font-size="16" font-weight="600" fill="#0f172a">Left Switch</text>
                                    <text x="500" y="50" text-anchor="middle" font-family="Inter" font-size="16" font-weight="600" fill="#0f172a">Right Switch</text>
                                </svg>
                                <div class="topology-caption">Figure 2.2: Custom topology with 4 hosts and 2 switches</div>
                            </div>
                            
                            <div class="concept-box">
                                <h4><i class="fas fa-lightbulb mr-2"></i>Key Concept: Topology Abstraction</h4>
                                <p>Mininet's Python API provides three levels of abstraction for creating network topologies: low-level (direct node creation), mid-level (using Mininet class methods), and high-level (using Topo class for reusable templates). This lab focuses on the high-level API for creating reusable topology templates.</p>
                            </div>
                            
                            <h3>Topology Design</h3>
                            <p>The topology consists of:</p>
                            <ul>
                                <li>4 hosts (h1, h2, h3, h4)</li>
                                <li>2 switches (s1, s2)</li>
                                <li>Interconnection: h1,h2 → s1 → s2 → h3,h4</li>
                            </ul>
                            
                            <div class="info-box">
                                <h4><i class="fas fa-info-circle mr-2"></i>Learning Outcomes</h4>
                                <ul>
                                    <li>Understanding Mininet's Topo class</li>
                                    <li>Creating custom network topologies</li>
                                    <li>Testing network connectivity</li>
                                    <li>Exporting topologies as reusable scripts</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="tab-content" data-tab="implementation">
                            <h3>Implementation Steps</h3>
                            
                            <h4>1. Create the Python Script</h4>
                            <p>Create a file named <code>myFirstTopo.py</code> with the following content:</p>
                            <pre><code class="language-python">#!/usr/bin/python
from mininet.topo import Topo
from mininet.net import Mininet
from mininet.util import dumpNodeConnections
from mininet.log import setLogLevel

class MyFirstTopo(Topo):
    "Simple topology example with 2 switches and 4 hosts."
    
    def __init__(self):
        # Initialize topology
        Topo.__init__(self)
        
        # Add hosts and switches
        h1 = self.addHost('h1')
        h2 = self.addHost('h2')
        h3 = self.addHost('h3')
        h4 = self.addHost('h4')
        leftSwitch = self.addSwitch('s1')
        rightSwitch = self.addSwitch('s2')
        
        # Add links
        self.addLink(h1, leftSwitch)
        self.addLink(h2, leftSwitch)
        self.addLink(leftSwitch, rightSwitch)
        self.addLink(rightSwitch, h3)
        self.addLink(rightSwitch, h4)

def runExperiment():
    "Create and test the custom topology"
    # Create topology instance
    topo = MyFirstTopo()
    
    # Create network with our topology
    net = Mininet(topo)
    
    # Start the network
    net.start()
    
    # Test connectivity
    print("Dumping host connections")
    dumpNodeConnections(net.hosts)
    
    print("Testing network connectivity")
    net.pingAll()
    
    # Stop the network
    net.stop()

if __name__ == '__main__':
    # Tell mininet to print useful information
    setLogLevel('info')
    runExperiment()</code></pre>
                            
                            <h4>2. Understanding the Code</h4>
                            <p>Key components of the script:</p>
                            <ul>
                                <li><code>MyFirstTopo</code> class inherits from <code>Topo</code> and defines our custom topology</li>
                                <li><code>addHost()</code> and <code>addSwitch()</code> methods create network nodes</li>
                                <li><code>addLink()</code> connects nodes together</li>
                                <li><code>runExperiment()</code> function creates the network and tests it</li>
                            </ul>
                            
                            <h4>3. Extended Version with CLI</h4>
                            <p>For interactive testing, create an extended version:</p>
                            <pre><code class="language-python">#!/usr/bin/python
from mininet.topo import Topo
from mininet.net import Mininet
from mininet.cli import CLI
from mininet.log import setLogLevel

class MyFirstTopo(Topo):
    def __init__(self):
        Topo.__init__(self)
        # Add hosts and switches
        h1 = self.addHost('h1', ip='10.0.0.1/24')
        h2 = self.addHost('h2', ip='10.0.0.2/24')
        h3 = self.addHost('h3', ip='10.0.0.3/24')
        h4 = self.addHost('h4', ip='10.0.0.4/24')
        s1 = self.addSwitch('s1')
        s2 = self.addSwitch('s2')
        
        # Add links
        self.addLink(h1, s1)
        self.addLink(h2, s1)
        self.addLink(s1, s2)
        self.addLink(s2, h3)
        self.addLink(s2, h4)

def runInteractive():
    topo = MyFirstTopo()
    net = Mininet(topo)
    net.start()
    
    # Start Mininet CLI for interactive commands
    CLI(net)
    
    net.stop()

if __name__ == '__main__':
    setLogLevel('info')
    runInteractive()</code></pre>
                        </div>
                        
                        <div class="tab-content" data-tab="testing">
                            <h3>Testing the Topology</h3>
                            
                            <h4>1. Running the Topology</h4>
                            <p>Execute the script with:</p>
                            <pre><code>sudo python myFirstTopo.py</code></pre>
                            
                            <h4>2. Automated Testing</h4>
                            <p>The script automatically runs connectivity tests:</p>
                            <pre><code>*** Dumping host connections
h1 h1-eth0:s1-eth1
h2 h2-eth0:s1-eth2
h3 h3-eth0:s2-eth1
h4 h4-eth0:s2-eth2
*** Testing network connectivity
h1 -> h2 h3 h4 
h2 -> h1 h3 h4 
h3 -> h1 h2 h4 
h4 -> h1 h2 h3 
*** Results: 0% dropped (12/12 received)</code></pre>
                            
                            <h4>3. Interactive Testing</h4>
                            <p>With the extended version, you can run manual tests:</p>
                            <pre><code>mininet> pingall
mininet> h1 ping -c 3 h3
mininet> net
mininet> iperf h1 h3</code></pre>
                            
                            <h4>4. Using from Command Line</h4>
                            <p>You can also use your custom topology with the Mininet command:</p>
                            <pre><code>sudo mn --custom myFirstTopo.py --topo myfirsttopo --test pingall</code></pre>
                            
                            <div class="info-box">
                                <h4><i class="fas fa-info-circle mr-2"></i>Testing Tips</h4>
                                <ul>
                                    <li>Use <code>pingall</code> to test all connections</li>
                                    <li>Use <code>net</code> to see the network configuration</li>
                                    <li>Use <code>dump</code> to see detailed node information</li>
                                    <li>Use <code>iperf</code> to test bandwidth between hosts</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg mt-6">
                            <h4 class="flex items-center text-blue-800 dark:text-blue-200">
                                <i class="fas fa-lightbulb mr-2"></i> Advanced Tip
                            </h4>
                            <p class="text-blue-700 dark:text-blue-300">You can parameterize your topology by adding parameters to the <code>__init__</code> method, making it reusable for different network sizes and configurations.</p>
                        </div>
                    `,
                    
                    'lab3-1': `
                        <div class="tab-container">
                            <div class="tab active" data-tab="overview">Overview</div>
                            <div class="tab" data-tab="implementation">Implementation</div>
                            <div class="tab" data-tab="testing">Testing</div>
                        </div>
                        
                        <div class="tab-content active" data-tab="overview">
                            <h3>Objective</h3>
                            <p>Implement a reactive Layer 2 switch using Ryu controller that performs MAC address learning and installs flow rules dynamically.</p>
                            
                            <div class="topology-figure">
                                <svg class="topology-svg" viewBox="0 0 800 500" xmlns="http://www.w3.org/2000/svg">
                                    <defs>
                                        <marker id="arrowhead3" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                            <polygon points="0 0, 10 3.5, 0 7" fill="#64748b"/>
                                        </marker>
                                    </defs>
                                    
                                    <!-- Hosts -->
                                    <rect x="100" y="100" width="80" height="60" rx="5" class="node-host"/>
                                    <text x="140" y="135" class="node-text">h1</text>
                                    <rect x="100" y="200" width="80" height="60" rx="5" class="node-host"/>
                                    <text x="140" y="235" class="node-text">h2</text>
                                    <rect x="100" y="300" width="80" height="60" rx="5" class="node-host"/>
                                    <text x="140" y="335" class="node-text">h3</text>
                                    <rect x="100" y="400" width="80" height="60" rx="5" class="node-host"/>
                                    <text x="140" y="435" class="node-text">h4</text>
                                    
                                    <!-- Switches -->
                                    <rect x="300" y="150" width="100" height="200" rx="10" class="node-switch"/>
                                    <text x="350" y="250" class="node-text">s1</text>
                                    
                                    <!-- Controller -->
                                    <rect x="550" y="200" width="100" height="100" rx="10" class="node-controller"/>
                                    <text x="600" y="260" class="node-text">Ryu</text>
                                    
                                    <!-- Links -->
                                    <line x1="180" y1="130" x2="300" y2="170" class="link-line"/>
                                    <line x1="180" y1="230" x2="300" y2="200" class="link-line"/>
                                    <line x1="180" y1="330" x2="300" y2="230" class="link-line"/>
                                    <line x1="180" y1="430" x2="300" y2="260" class="link-line"/>
                                    <line x1="400" y1="250" x2="550" y2="250" class="link-line" stroke-dasharray="5,5"/>
                                    
                                    <!-- Flow Rules -->
                                    <rect x="320" y="280" width="60" height="40" fill="#fef3c7" stroke="#d97706" stroke-width="1"/>
                                    <text x="350" y="305" font-family="Inter" font-size="10" text-anchor="middle" fill="#92400e">Flow Table</text>
                                    
                                    <!-- Labels -->
                                    <text x="350" y="100" text-anchor="middle" font-family="Inter" font-size="16" font-weight="600" fill="#0f172a">OpenFlow Switch</text>
                                    <text x="600" y="170" text-anchor="middle" font-family="Inter" font-size="16" font-weight="600" fill="#0f172a">Ryu Controller</text>
                                    <text x="475" y="220" text-anchor="middle" font-family="Inter" font-size="14" fill="#64748b">OpenFlow</text>
                                </svg>
                                <div class="topology-caption">Figure 3.1: Reactive L2 switch with Ryu controller</div>
                            </div>
                            
                            <div class="concept-box">
                                <h4><i class="fas fa-lightbulb mr-2"></i>Key Concept: Reactive Flow Installation</h4>
                                <p>Reactive flow installation means the controller installs flow rules only when needed. When a packet arrives at the switch without a matching flow rule, it's sent to the controller (PACKET_IN). The controller processes the packet, determines the appropriate action, installs a flow rule for future packets (FLOW_MOD), and sends the packet to its destination (PACKET_OUT).</p>
                            </div>
                            
                            <h3>How L2 Learning Switch Works</h3>
                            <ol>
                                <li><strong>Initial State:</strong> Switch has no flow rules (only table-miss entry)</li>
                                <li><strong>First Packet:</strong> Packet from h1 to h2 arrives, no flow match → PACKET_IN to controller</li>
                                <li><strong>Learning:</strong> Controller learns h1 is at port 1</li>
                                <li><strong>Flow Installation:</strong> Controller installs flow rule for h1 → port 1</li>
                                <li><strong>Forwarding:</strong> If h2 location is known, install flow and forward; otherwise flood</li>
                                <li><strong>Subsequent Packets:</strong> Match existing flow rules, no controller involvement</li>
                            </ol>
                            
                            <div class="info-box">
                                <h4><i class="fas fa-info-circle mr-2"></i>Learning Outcomes</h4>
                                <ul>
                                    <li>Understanding OpenFlow PACKET_IN/FLOW_MOD/PACKET_OUT workflow</li>
                                    <li>Implementing MAC address learning</li>
                                    <li>Creating dynamic flow rules in Ryu</li>
                                    <li>Testing reactive controller behavior</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="tab-content" data-tab="implementation">
                            <h3>Implementation Steps</h3>
                            
                            <h4>1. Create the Ryu Application</h4>
                            <p>Create a file named <code>switch_l2.py</code> with the following content:</p>
                            <pre><code class="language-python">from ryu.base import app_manager
from ryu.controller import ofp_event
from ryu.controller.handler import CONFIG_DISPATCHER, MAIN_DISPATCHER
from ryu.controller.handler import set_ev_cls
from ryu.ofproto import ofproto_v1_3
from ryu.lib.packet import packet
from ryu.lib.packet import ethernet

class SimpleSwitchL2(app_manager.RyuApp):
    OFP_VERSIONS = [ofproto_v1_3.OFP_VERSION]

    def __init__(self, *args, **kwargs):
        super(SimpleSwitchL2, self).__init__(*args, **kwargs)
        # MAC learning table: {dpid: {mac: port}}
        self.mac_to_port = {}

    @set_ev_cls(ofp_event.EventOFPSwitchFeatures, CONFIG_DISPATCHER)
    def switch_features_handler(self, ev):
        """Handle switch connection and install table-miss flow entry."""
        datapath = ev.msg.datapath
        ofproto = datapath.ofproto
        parser = datapath.ofproto_parser

        # Install table-miss flow entry
        match = parser.OFPMatch()
        actions = [parser.OFPActionOutput(ofproto.OFPP_CONTROLLER,
                                          ofproto.OFPCML_NO_BUFFER)]
        self.add_flow(datapath, 0, match, actions)

    def add_flow(self, datapath, priority, match, actions, buffer_id=None):
        """Add a flow entry to the switch."""
        ofproto = datapath.ofproto
        parser = datapath.ofproto_parser

        inst = [parser.OFPInstructionActions(ofproto.OFPIT_APPLY_ACTIONS,
                                             actions)]
        if buffer_id:
            mod = parser.OFPFlowMod(datapath=datapath, buffer_id=buffer_id,
                                    priority=priority, match=match,
                                    instructions=inst)
        else:
            mod = parser.OFPFlowMod(datapath=datapath, priority=priority,
                                    match=match, instructions=inst)
        datapath.send_msg(mod)

    @set_ev_cls(ofp_event.EventOFPPacketIn, MAIN_DISPATCHER)
    def _packet_in_handler(self, ev):
        """Handle packet_in events, learn MAC addresses, and install flows."""
        # If you hit this you might want to increase
        # the "miss_send_length" of your switch
        if ev.msg.msg_len < ev.msg.total_len:
            self.logger.debug("packet truncated: only %s of %s bytes",
                              ev.msg.msg_len, ev.msg.total_len)
        msg = ev.msg
        datapath = msg.datapath
        ofproto = datapath.ofproto
        parser = datapath.ofproto_parser
        in_port = msg.match['in_port']

        pkt = packet.Packet(msg.data)
        eth = pkt.get_protocol(ethernet.ethernet)[0]

        if eth.ethertype == 35020 or eth.ethertype == 34525:  # IPv6
            # Ignore IPv6 packets
            return

        dst = eth.dst
        src = eth.src

        dpid = datapath.id
        self.mac_to_port.setdefault(dpid, {})

        self.logger.info("packet in %s %s %s %s", dpid, src, dst, in_port)

        # Learn the source MAC address
        self.mac_to_port[dpid][src] = in_port

        if dst in self.mac_to_port[dpid]:
            out_port = self.mac_to_port[dpid][dst]
        else:
            out_port = ofproto.OFPP_FLOOD

        actions = [parser.OFPActionOutput(out_port)]

        # Install a flow to avoid packet_in next time
        if out_port != ofproto.OFPP_FLOOD:
            match = parser.OFPMatch(in_port=in_port, eth_dst=dst)
            # Verify if we have a valid buffer_id, if yes avoid to send both
            # flow_mod & packet_out
            if msg.buffer_id != ofproto.OFP_NO_BUFFER:
                self.add_flow(datapath, 1, match, actions, msg.buffer_id)
                return
            else:
                self.add_flow(datapath, 1, match, actions)
        
        data = None
        if msg.buffer_id == ofproto.OFP_NO_BUFFER:
            data = msg.data

        out = parser.OFPPacketOut(datapath=datapath, buffer_id=msg.buffer_id,
                                  in_port=in_port, actions=actions, data=data)
        datapath.send_msg(out)</code></pre>
                            
                            <h4>2. Code Explanation</h4>
                            <p>Key components of the L2 switch:</p>
                            <ul>
                                <li><code>mac_to_port</code>: Dictionary storing learned MAC addresses and their ports</li>
                                <li><code>switch_features_handler</code>: Installs table-miss flow entry when switch connects</li>
                                <li><code>add_flow</code>: Helper function to install flow rules</li>
                                <li><code>_packet_in_handler</code>: Main logic for handling packets and learning MACs</li>
                            </ul>
                            
                            <h4>3. OpenFlow Message Flow</h4>
                            <ol>
                                <li><strong>Switch Features:</strong> Switch connects → FEATURES_REPLY → Install table-miss</li>
                                <li><strong>First Packet:</strong> Packet arrives → No flow match → PACKET_IN to controller</li>
                                <li><strong>Controller Processing:</strong> Learn source MAC, determine output port</li>
                                <li><strong>Flow Installation:</strong> Install specific flow rule → FLOW_MOD</li>
                                <li><strong>Packet Forwarding:</strong> Send original packet → PACKET_OUT</li>
                                <li><strong>Future Packets:</strong> Match installed flow → Forward directly at switch</li>
                            </ol>
                        </div>
                        
                        <div class="tab-content" data-tab="testing">
                            <h3>Testing the L2 Switch</h3>
                            
                            <h4>1. Start the Controller</h4>
                            <pre><code>ryu-manager switch_l2.py --verbose</code></pre>
                            
                            <h4>2. Create Test Topology</h4>
                            <p>Use the simple topology from Lab 3 Intro:</p>
                            <pre><code class="language-python">#!/usr/bin/python
from mininet.net import Mininet
from mininet.node import OVSSwitch, RemoteController
from mininet.cli import CLI

def topology():
    net = Mininet(controller=RemoteController, switch=OVSSwitch)
    c0 = net.addController('c0', ip='127.0.0.1', port=6633)
    
    h1 = net.addHost('h1', ip='10.0.0.1/24')
    h2 = net.addHost('h2', ip='10.0.0.2/24')
    h3 = net.addHost('h3', ip='10.0.0.3/24')
    h4 = net.addHost('h4', ip='10.0.0.4/24')
    
    s1 = net.addSwitch('s1')
    s2 = net.addSwitch('s2')
    
    net.addLink(h1, s1)
    net.addLink(h2, s1)
    net.addLink(h3, s2)
    net.addLink(h4, s2)
    net.addLink(s1, s2)
    
    net.build()
    c0.start()
    s1.start([c0])
    s2.start([c0])
    
    CLI(net)
    net.stop()

if __name__ == '__main__':
    topology()</code></pre>
                            
                            <h4>3. Test Scenarios</h4>
                            <p>Run the topology and test various scenarios:</p>
                            <pre><code># Start Mininet
sudo python simple_topo.py

# Test connectivity
mininet> pingall

# Check flow tables
mininet> sh ovs-ofctl dump-flows s1
mininet> sh ovs-ofctl dump-flows s2

# Test specific hosts
mininet> h1 ping -c 3 h3
mininet> h2 ping -c 3 h4

# Monitor controller logs
# In another terminal, watch Ryu output</code></pre>
                            
                            <h4>4. Expected Results</h4>
                            <ul>
                                <li>First ping between hosts will show PACKET_IN messages in controller logs</li>
                                <li>Subsequent pings will use installed flow rules</li>
                                <li>Flow tables will show specific rules for known MAC addresses</li>
                                <li>All hosts should be able to communicate with each other</li>
                            </ul>
                            
                            <h4>5. Verify Learning Behavior</h4>
                            <pre><code># Check learned MAC addresses in flow tables
mininet> sh ovs-ofctl dump-flows s1

# Example output:
# cookie=0x0, duration=10.123s, table=0, n_packets=5, n_bytes=420, 
# priority=1,dl_dst=00:00:00:00:00:02 actions=output:2
# cookie=0x0, duration=10.120s, table=0, n_packets=5, n_bytes=420, 
# priority=1,dl_dst=00:00:00:00:00:01 actions=output:1</code></pre>
                            
                            <div class="info-box">
                                <h4><i class="fas fa-info-circle mr-2"></i>Debugging Tips</h4>
                                <ul>
                                    <li>Use <code>--verbose</code> flag with ryu-manager for detailed logs</li>
                                    <li>Check OpenFlow version compatibility (use OpenFlow 1.3)</li>
                                    <li>Verify controller IP and port in Mininet topology</li>
                                    <li>Use Wireshark to capture OpenFlow messages for analysis</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg mt-6">
                            <h4 class="flex items-center text-blue-800 dark:text-blue-200">
                                <i class="fas fa-lightbulb mr-2"></i> Advanced Tip
                            </h4>
                            <p class="text-blue-700 dark:text-blue-300">You can extend this L2 switch by adding features like VLAN support, spanning tree protocol, or quality of service (QoS) by modifying the flow rules and packet processing logic.</p>
                        </div>
                    `,
                    
                    'lab5-1': `
                        <div class="tab-container">
                            <div class="tab active" data-tab="overview">Overview</div>
                            <div class="tab" data-tab="implementation">Implementation</div>
                            <div class="tab" data-tab="testing">Testing</div>
                        </div>
                        
                        <div class="tab-content active" data-tab="overview">
                            <h3>Objective</h3>
                            <p>Implement a proactive load balancer that distributes traffic from multiple clients to a server across multiple paths using static flow rules.</p>
                            
                            <div class="topology-figure">
                                <svg class="topology-svg" viewBox="0 0 800 600" xmlns="http://www.w3.org/2000/svg">
                                    <defs>
                                        <marker id="arrowhead5" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                            <polygon points="0 0, 10 3.5, 0 7" fill="#64748b"/>
                                        </marker>
                                    </defs>
                                    
                                    <!-- Hosts -->
                                    <rect x="100" y="100" width="80" height="60" rx="5" class="node-host"/>
                                    <text x="140" y="135" class="node-text">h1</text>
                                    <rect x="100" y="200" width="80" height="60" rx="5" class="node-host"/>
                                    <text x="140" y="235" class="node-text">h2</text>
                                    
                                    <rect x="700" y="300" width="80" height="60" rx="5" class="node-server"/>
                                    <text x="740" y="335" class="node-text">Server</text>
                                    
                                    <!-- Switches -->
                                    <rect x="250" y="50" width="100" height="100" rx="10" class="node-switch"/>
                                    <text x="300" y="110" class="node-text">s1</text>
                                    
                                    <rect x="250" y="200" width="100" height="100" rx="10" class="node-switch"/>
                                    <text x="300" y="260" class="node-text">s2</text>
                                    
                                    <rect x="250" y="350" width="100" height="100" rx="10" class="node-switch"/>
                                    <text x="300" y="410" class="node-text">s3</text>
                                    
                                    <rect x="450" y="200" width="100" height="100" rx="10" class="node-switch"/>
                                    <text x="500" y="260" class="node-text">s4</text>
                                    
                                    <!-- Controller -->
                                    <rect x="650" y="50" width="100" height="100" rx="10" class="node-controller"/>
                                    <text x="700" y="110" class="node-text">Ryu</text>
                                    
                                    <!-- Links -->
                                    <line x1="180" y1="130" x2="250" y2="100" class="link-line"/>
                                    <line x1="180" y1="230" x2="250" y2="250" class="link-line"/>
                                    
                                    <line x1="350" y1="100" x2="450" y2="200" class="link-line" stroke="#3b82f6" stroke-width="3"/>
                                    <line x1="350" y1="250" x2="450" y2="200" class="link-line" stroke="#10b981" stroke-width="3"/>
                                    <line x1="350" y1="400" x2="450" y2="200" class="link-line" stroke="#f59e0b" stroke-width="3"/>
                                    
                                    <line x1="550" y1="250" x2="700" y2="300" class="link-line"/>
                                    
                                    <line x1="700" y1="150" x2="650" y2="200" class="link-line" stroke-dasharray="5,5"/>
                                    
                                    <!-- Path Labels -->
                                    <text x="400" y="70" text-anchor="middle" font-family="Inter" font-size="14" font-weight="600" fill="#3b82f6">Path 1 (H1)</text>
                                    <text x="400" y="220" text-anchor="middle" font-family="Inter" font-size="14" font-weight="600" fill="#10b981">Path 2 (H2)</text>
                                    <text x="400" y="370" text-anchor="middle" font-family="Inter" font-size="14" font-weight="600" fill="#f59e0b">Path 3</text>
                                    
                                    <!-- Load Balancer Label -->
                                    <text x="300" y="20" text-anchor="middle" font-family="Inter" font-size="16" font-weight="600" fill="#0f172a">Load Balancer (s1)</text>
                                </svg>
                                <div class="topology-caption">Figure 5.1: Load balancer with multiple paths to server</div>
                            </div>
                            
                            <div class="concept-box">
                                <h4><i class="fas fa-lightbulb mr-2"></i>Key Concept: Proactive Flow Installation</h4>
                                <p>Proactive flow installation means the controller installs all necessary flow rules before any traffic flows. This approach provides deterministic behavior, lower latency for the first packet, and doesn't require controller involvement during normal operation. The load balancer distributes traffic based on source IP, ensuring each client uses a consistent path.</p>
                            </div>
                            
                            <h3>Load Balancing Strategy</h3>
                            <p>This implementation uses a simple source-based load balancing:</p>
                            <ul>
                                <li><strong>H1 → Server:</strong> Uses Path 1 (s1 → s2 → s4)</li>
                                <li><strong>H2 → Server:</strong> Uses Path 2 (s1 → s3 → s4)</li>
                                <li><strong>Other traffic:</strong> Uses Path 3 (s1 → s5 → s4)</li>
                                <li><strong>Return traffic:</strong> Maintains symmetric paths</li>
                            </ul>
                            
                            <div class="info-box">
                                <h4><i class="fas fa-info-circle mr-2"></i>Real-World Applications</h4>
                                <ul>
                                    <li>Data center traffic engineering</li>
                                    <li>Content delivery networks (CDNs)</li>
                                    <li>Cloud service load distribution</li>
                                    <li>Multi-homed network connections</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="tab-content" data-tab="implementation">
                            <h3>Implementation Steps</h3>
                            
                            <h4>1. Create the Topology</h4>
                            <p>Create <code>LoadBalancerTopo.py</code>:</p>
                            <pre><code class="language-python">#!/usr/bin/python
from mininet.net import Mininet
from mininet.node import Controller, OVSSwitch, RemoteController
from mininet.cli import CLI
from mininet.log import setLogLevel, info

def load_balancer_topo():
    "Create load balancer topology with multiple paths"
    net = Mininet(controller=RemoteController, switch=OVSSwitch)
    
    # Add controller
    c0 = net.addController('c0', ip='127.0.0.1', port=6633)
    
    # Add hosts
    h1 = net.addHost('h1', ip='10.0.0.1/24')
    h2 = net.addHost('h2', ip='10.0.0.2/24')
    server = net.addHost('server', ip='10.0.0.10/24')
    
    # Add switches
    s1 = net.addSwitch('s1')  # Load balancer
    s2 = net.addSwitch('s2')  # Path 1
    s3 = net.addSwitch('s3')  # Path 2
    s4 = net.addSwitch('s4')  # Aggregation
    
    # Create links
    net.addLink(h1, s1)
    net.addLink(h2, s1)
    net.addLink(s1, s2)  # Path 1 start
    net.addLink(s1, s3)  # Path 2 start
    net.addLink(s2, s4)  # Path 1 continuation
    net.addLink(s3, s4)  # Path 2 continuation
    net.addLink(s4, server)
    
    net.build()
    c0.start()
    s1.start([c0])
    s2.start([c0])
    s3.start([c0])
    s4.start([c0])
    
    CLI(net)
    net.stop()

if __name__ == '__main__':
    setLogLevel('info')
    load_balancer_topo()</code></pre>
                            
                            <h4>2. Create Load Balancer Controller</h4>
                            <p>Create <code>load_balancer.py</code> Ryu application:</p>
                            <pre><code class="language-python">from ryu.base import app_manager
from ryu.controller import ofp_event
from ryu.controller.handler import CONFIG_DISPATCHER
from ryu.controller.handler import set_ev_cls
from ryu.ofproto import ofproto_v1_3

class LoadBalancer(app_manager.RyuApp):
    OFP_VERSIONS = [ofproto_v1_3.OFP_VERSION]
    
    def __init__(self, *args, **kwargs):
        super(LoadBalancer, self).__init__(*args, **kwargs)
        
    @set_ev_cls(ofp_event.EventOFPSwitchFeatures, CONFIG_DISPATCHER)
    def switch_features_handler(self, ev):
        datapath = ev.msg.datapath
        ofproto = datapath.ofproto
        parser = datapath.ofproto_parser
        dpid = datapath.id
        
        # Install different rules based on switch role
        if dpid == 1:  # Load balancer switch (s1)
            self.install_load_balancer_rules(datapath)
        elif dpid == 2:  # Path 1 switch (s2)
            self.install_path1_rules(datapath)
        elif dpid == 3:  # Path 2 switch (s3)
            self.install_path2_rules(datapath)
        elif dpid == 4:  # Aggregation switch (s4)
            self.install_aggregation_rules(datapath)
    
    def install_load_balancer_rules(self, datapath):
        "Install load balancing rules on s1"
        ofproto = datapath.ofproto
        parser = datapath.ofproto_parser
        
        # Allow ARP traffic (flood)
        match = parser.OFPMatch(eth_type=0x0806)
        actions = [parser.OFPActionOutput(ofproto.OFPP_FLOOD)]
        self.add_flow(datapath, 100, match, actions)
        
        # H1 traffic -> Path 1 (port 3)
        match = parser.OFPMatch(eth_type=0x0800, ipv4_src='10.0.0.1')
        actions = [parser.OFPActionOutput(3)]
        self.add_flow(datapath, 10, match, actions)
        
        # H2 traffic -> Path 2 (port 4)
        match = parser.OFPMatch(eth_type=0x0800, ipv4_src='10.0.0.2')
        actions = [parser.OFPActionOutput(4)]
        self.add_flow(datapath, 10, match, actions)
        
        # Return traffic from server to H1 -> port 1
        match = parser.OFPMatch(eth_type=0x0800, ipv4_dst='10.0.0.1')
        actions = [parser.OFPActionOutput(1)]
        self.add_flow(datapath, 10, match, actions)
        
        # Return traffic from server to H2 -> port 2
        match = parser.OFPMatch(eth_type=0x0800, ipv4_dst='10.0.0.2')
        actions = [parser.OFPActionOutput(2)]
        self.add_flow(datapath, 10, match, actions)
    
    def install_path1_rules(self, datapath):
        "Install forwarding rules for Path 1 (s2)"
        ofproto = datapath.ofproto
        parser = datapath.ofproto_parser
        
        # Allow ARP
        match = parser.OFPMatch(eth_type=0x0806)
        actions = [parser.OFPActionOutput(ofproto.OFPP_FLOOD)]
        self.add_flow(datapath, 100, match, actions)
        
        # Forward traffic from s1 to s4
        match = parser.OFPMatch(in_port=1)
        actions = [parser.OFPActionOutput(2)]
        self.add_flow(datapath, 10, match, actions)
        
        # Return traffic from s4 to s1
        match = parser.OFPMatch(in_port=2)
        actions = [parser.OFPActionOutput(1)]
        self.add_flow(datapath, 10, match, actions)
    
    def install_path2_rules(self, datapath):
        "Install forwarding rules for Path 2 (s3)"
        ofproto = datapath.ofproto
        parser = datapath.ofproto_parser
        
        # Allow ARP
        match = parser.OFPMatch(eth_type=0x0806)
        actions = [parser.OFPActionOutput(ofproto.OFPP_FLOOD)]
        self.add_flow(datapath, 100, match, actions)
        
        # Forward traffic from s1 to s4
        match = parser.OFPMatch(in_port=1)
        actions = [parser.OFPActionOutput(2)]
        self.add_flow(datapath, 10, match, actions)
        
        # Return traffic from s4 to s1
        match = parser.OFPMatch(in_port=2)
        actions = [parser.OFPActionOutput(1)]
        self.add_flow(datapath, 10, match, actions)
    
    def install_aggregation_rules(self, datapath):
        "Install aggregation rules on s4"
        ofproto = datapath.ofproto
        parser = datapath.ofproto_parser
        
        # Allow ARP
        match = parser.OFPMatch(eth_type=0x0806)
        actions = [parser.OFPActionOutput(ofproto.OFPP_FLOOD)]
        self.add_flow(datapath, 100, match, actions)
        
        # Forward all IP traffic to server
        match = parser.OFPMatch(eth_type=0x0800, ipv4_dst='10.0.0.10')
        actions = [parser.OFPActionOutput(3)]
        self.add_flow(datapath, 10, match, actions)
        
        # Return traffic from server to Path 1 (H1)
        match = parser.OFPMatch(eth_type=0x0800, ipv4_src='10.0.0.10', ipv4_dst='10.0.0.1')
        actions = [parser.OFPActionOutput(1)]
        self.add_flow(datapath, 10, match, actions)
        
        # Return traffic from server to Path 2 (H2)
        match = parser.OFPMatch(eth_type=0x0800, ipv4_src='10.0.0.10', ipv4_dst='10.0.0.2')
        actions = [parser.OFPActionOutput(2)]
        self.add_flow(datapath, 10, match, actions)
    
    def add_flow(self, datapath, priority, match, actions):
        "Helper function to add flow entry"
        ofproto = datapath.ofproto
        parser = datapath.ofproto_parser
        
        inst = [parser.OFPInstructionActions(ofproto.OFPIT_APPLY_ACTIONS,
                                             actions)]
        mod = parser.OFPFlowMod(datapath=datapath, priority=priority,
                                match=match, instructions=inst)
        datapath.send_msg(mod)</code></pre>
                            
                            <h4>3. Understanding the Load Balancing Logic</h4>
                            <p>The load balancer works by:</p>
                            <ul>
                                <li><strong>Source-based distribution:</strong> Different source IPs use different paths</li>
                                <li><strong>Proactive rules:</strong> All flows installed at startup</li>
                                <li><strong>Symmetric paths:</strong> Return traffic uses the same path as forward traffic</li>
                                <li><strong>ARP handling:</strong> Broadcast ARP for address resolution</li>
                            </ul>
                        </div>
                        
                        <div class="tab-content" data-tab="testing">
                            <h3>Testing the Load Balancer</h3>
                            
                            <h4>1. Start the Controller</h4>
                            <pre><code>ryu-manager load_balancer.py</code></pre>
                            
                            <h4>2. Start the Topology</h4>
                            <pre><code>sudo python LoadBalancerTopo.py</code></pre>
                            
                            <h4>3. Verify Flow Installation</h4>
                            <pre><code>mininet> sh ovs-ofctl dump-flows s1
mininet> sh ovs-ofctl dump-flows s2
mininet> sh ovs-ofctl dump-flows s3
mininet> sh ovs-ofctl dump-flows s4</code></pre>
                            
                            <h4>4. Test Load Balancing</h4>
                            <pre><code># Test H1 to Server (should use Path 1)
mininet> h1 ping -c 3 server

# Test H2 to Server (should use Path 2)
mininet> h2 ping -c 3 server

# Verify paths using tcpdump
mininet> h1 tcpdump -i h1-eth0 -n &
mininet> h2 tcpdump -i h2-eth0 -n &
mininet> server tcpdump -i server-eth0 -n &</code></pre>
                            
                            <h4>5. Monitor Traffic Paths</h4>
                            <pre><code># Check which path each host is using
mininet> sh ovs-ofctl dump-flows s1 | grep 10.0.0.1
mininet> sh ovs-ofctl dump-flows s1 | grep 10.0.0.2

# Monitor packet counters to see load distribution
mininet> sh ovs-ofctl dump-flows s2 | grep n_packets
mininet> sh ovs-ofctl dump-flows s3 | grep n_packets</code></pre>
                            
                            <h4>6. Performance Testing</h4>
                            <pre><code># Test bandwidth on each path
mininet> iperf h1 server
mininet> iperf h2 server

# Run simultaneous tests
mininet> h1 iperf -s &
mininet> h2 iperf -s &
mininet> server iperf -c 10.0.0.1
mininet> server iperf -c 10.0.0.2</code></pre>
                            
                            <div class="info-box">
                                <h4><i class="fas fa-info-circle mr-2"></i>Testing Tips</h4>
                                <ul>
                                    <li>Use <code>tcpdump</code> to verify traffic is using the correct paths</li>
                                    <li>Check flow table counters to monitor traffic distribution</li>
                                    <li>Test with multiple simultaneous connections</li>
                                    <li>Verify that return traffic uses the same path as forward traffic</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg mt-6">
                            <h4 class="flex items-center text-blue-800 dark:text-blue-200">
                                <i class="fas fa-lightbulb mr-2"></i> Advanced Tip
                            </h4>
                            <p class="text-blue-700 dark:text-blue-300">You can extend this load balancer by implementing dynamic load balancing based on real-time link utilization, adding health checks for paths, or implementing weighted distribution for different types of traffic.</p>
                        </div>
                    `,
                    
                    'lab7-1': `
                        <div class="tab-container">
                            <div class="tab active" data-tab="overview">Overview</div>
                            <div class="tab" data-tab="implementation">Implementation</div>
                            <div class="tab" data-tab="research">Research Context</div>
                        </div>
                        
                        <div class="tab-content active" data-tab="overview">
                            <h3>Objective</h3>
                            <p>Implement Network Function Virtualization (NFV) using SDN to dynamically deploy virtual network functions (VNFs) and create service chains.</p>
                            
                            <div class="topology-figure">
                                <svg class="topology-svg" viewBox="0 0 800 600" xmlns="http://www.w3.org/2000/svg">
                                    <defs>
                                        <marker id="arrowhead7" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                            <polygon points="0 0, 10 3.5, 0 7" fill="#64748b"/>
                                        </marker>
                                    </defs>
                                    
                                    <!-- Clients -->
                                    <rect x="50" y="100" width="80" height="60" rx="5" class="node-host"/>
                                    <text x="90" y="135" class="node-text">Client 1</text>
                                    <rect x="50" y="200" width="80" height="60" rx="5" class="node-host"/>
                                    <text x="90" y="235" class="node-text">Client 2</text>
                                    
                                    <!-- Service Chain -->
                                    <rect x="200" y="50" width="100" height="80" rx="5" class="node-router"/>
                                    <text x="250" y="95" class="node-text">Classifier</text>
                                    
                                    <rect x="350" y="50" width="100" height="80" rx="5" fill="#f59e0b" stroke="#d97706" stroke-width="2"/>
                                    <text x="400" y="95" class="node-text">Firewall</text>
                                    
                                    <rect x="500" y="50" width="100" height="80" rx="5" fill="#8b5cf6" stroke="#7c3aed" stroke-width="2"/>
                                    <text x="550" y="95" class="node-text">NAT</text>
                                    
                                    <rect x="650" y="50" width="100" height="80" rx="5" fill="#10b981" stroke="#047857" stroke-width="2"/>
                                    <text x="700" y="95" class="node-text">Load Balancer</text>
                                    
                                    <!-- Servers -->
                                    <rect x="350" y="400" width="80" height="60" rx="5" class="node-server"/>
                                    <text x="390" y="435" class="node-text">Web 1</text>
                                    <rect x="500" y="400" width="80" height="60" rx="5" class="node-server"/>
                                    <text x="540" y="435" class="node-text">Web 2</text>
                                    <rect x="650" y="400" width="80" height="60" rx="5" class="node-server"/>
                                    <text x="690" y="435" class="node-text">Web 3</text>
                                    
                                    <!-- Controller -->
                                    <rect x="700" y="250" width="100" height="100" rx="10" class="node-controller"/>
                                    <text x="750" y="310" class="node-text">NFV Controller</text>
                                    
                                    <!-- Service Chain Lines -->
                                    <line x1="150" y1="150" x2="200" y2="90" class="link-line"/>
                                    <line x1="300" y1="90" x2="350" y2="90" class="link-line"/>
                                    <line x1="450" y1="90" x2="500" y2="90" class="link-line"/>
                                    <line x1="600" y1="90" x2="650" y2="90" class="link-line"/>
                                    <line x1="750" y1="90" x2="750" y2="150" class="link-line"/>
                                    <line x1="750" y1="150" x2="690" y2="400" class="link-line"/>
                                    
                                    <!-- Bypass for management traffic -->
                                    <line x1="300" y1="130" x2="390" y2="400" class="link-line" stroke-dasharray="5,5" stroke="#64748b"/>
                                    
                                    <!-- Service Chain Label -->
                                    <text x="425" y="20" text-anchor="middle" font-family="Inter" font-size="16" font-weight="600" fill="#0f172a">Service Function Chain</text>
                                    
                                    <!-- Traffic Labels -->
                                    <text x="125" y="80" text-anchor="middle" font-family="Inter" font-size="12" fill="#3b82f6">Web Traffic</text>
                                    <text x="125" y="280" text-anchor="middle" font-family="Inter" font-size="12" fill="#10b981">Management Traffic</text>
                                </svg>
                                <div class="topology-caption">Figure 7.1: NFV architecture with dynamic service chains</div>
                            </div>
                            
                            <div class="concept-box">
                                <h4><i class="fas fa-lightbulb mr-2"></i>Key Concept: Service Function Chaining</h4>
                                <p>Network Function Virtualization (NFV) decouples network functions from proprietary hardware appliances, allowing them to run as software on commercial off-the-shelf servers. Service Function Chaining (SFC) defines the ordered sequence of VNFs through which traffic must flow. This enables dynamic, flexible network services that can be scaled and updated without changing physical infrastructure.</p>
                            </div>
                            
                            <h3>NFV Architecture Components</h3>
                            <ul>
                                <li><strong>VNFs (Virtual Network Functions):</strong> Software implementations of network functions (firewall, NAT, load balancer)</li>
                                <li><strong>Service Chains:</strong> Ordered sequences of VNFs for specific traffic types</li>
                                <li><strong>Classifiers:</strong> Identify traffic and assign to appropriate service chains</li>
                                <li><strong>NFV Orchestrator:</strong> Manages VNF lifecycle and service chain creation</li>
                                <li><strong>SDN Controller:</strong> Steers traffic through the appropriate service chains</li>
                            </ul>
                            
                            <div class="info-box">
                                <h4><i class="fas fa-info-circle mr-2"></i>Real-World Applications</h4>
                                <ul>
                                    <li>Telecom networks (5G core network slicing)</li>
                                    <li>Cloud-native network services</li>
                                    <li>Enterprise security services</li>
                                    <li>IoT gateway functions</li>
                                    <li>Content delivery optimization</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="tab-content" data-tab="implementation">
                            <h3>Implementation Steps</h3>
                            
                            <h4>1. Create NFV Topology</h4>
                            <p>Create <code>nfv_topo.py</code> with VNF hosts and service chains:</p>
                            <pre><code class="language-python">#!/usr/bin/env python
from mininet.net import Mininet
from mininet.node import OVSSwitch, RemoteController
from mininet.cli import CLI
from mininet.log import setLogLevel

def nfv_topology():
    "Create NFV topology with VNFs and service chains"
    net = Mininet(controller=RemoteController, switch=OVSSwitch)
    
    # Add NFV-aware controller
    c0 = net.addController('c0', ip='127.0.0.1', port=6653)
    
    # Add clients
    client1 = net.addHost('client1', ip='10.0.0.1/24')
    client2 = net.addHost('client2', ip='10.0.0.2/24')
    
    # Add servers
    web1 = net.addHost('web1', ip='10.0.0.101/24')
    web2 = net.addHost('web2', ip='10.0.0.102/24')
    web3 = net.addHost('web3', ip='10.0.0.103/24')
    
    # Add VNF hosts (running network functions)
    firewall = net.addHost('firewall', ip='10.0.1.10/24')
    nat = net.addHost('nat', ip='10.0.1.11/24')
    load_balancer = net.addHost('load_balancer', ip='10.0.1.12/24')
    
    # Add switches
    s1 = net.addSwitch('s1')  # Client facing
    s2 = net.addSwitch('s2')  # Firewall switch
    s3 = net.addSwitch('s3')  # NAT switch  
    s4 = net.addSwitch('s4')  # Load balancer switch
    s5 = net.addSwitch('s5')  # Server facing
    
    # Create service chain topology
    net.addLink(client1, s1)
    net.addLink(client2, s1)
    net.addLink(s1, s2)      # To firewall
    net.addLink(s2, firewall)
    net.addLink(firewall, s3) # Firewall to NAT
    net.addLink(s3, nat)
    net.addLink(nat, s4)     # NAT to load balancer
    net.addLink(s4, load_balancer)
    net.addLink(load_balancer, s5)
    net.addLink(s5, web1)
    net.addLink(s5, web2)
    net.addLink(s5, web3)
    
    # Bypass path for management traffic
    net.addLink(s1, s5)
    
    net.build()
    c0.start()
    s1.start([c0])
    s2.start([c0])
    s3.start([c0])
    s4.start([c0])
    s5.start([c0])
    
    # Start simple VNF services (in real implementation, these would be proper services)
    print("Starting VNF services...")
    firewall.cmd('echo "Starting firewall" > /tmp/firewall.log &')
    nat.cmd('echo "Starting NAT" > /tmp/nat.log &')
    load_balancer.cmd('echo "Starting load balancer" > /tmp/lb.log &')
    
    CLI(net)
    net.stop()

if __name__ == '__main__':
    setLogLevel('info')
    nfv_topology()</code></pre>
                            
                            <h4>2. Create NFV Controller</h4>
                            <p>Create <code>nfv_controller.py</code> Ryu application:</p>
                            <pre><code class="language-python">from ryu.base import app_manager
from ryu.controller import ofp_event
from ryu.controller.handler import CONFIG_DISPATCHER, MAIN_DISPATCHER
from ryu.controller.handler import set_ev_cls
from ryu.ofproto import ofproto_v1_3
from ryu.lib.packet import packet, ethernet, ipv4, tcp, udp

class NFVController(app_manager.RyuApp):
    OFP_VERSIONS = [ofproto_v1_3.OFP_VERSION]
    
    def __init__(self, *args, **kwargs):
        super(NFVController, self).__init__(*args, **kwargs)
        
        # Define service chains for different traffic types
        self.service_chains = {
            'web_traffic': ['firewall', 'nat', 'load_balancer'],
            'voip_traffic': ['firewall', 'nat'],  # No load balancing for VoIP
            'management_traffic': ['firewall']    # Only firewall for management
        }
        
        # VNF port mappings
        self.vnf_ports = {
            'firewall': 3,
            'nat': 4,
            'load_balancer': 5
        }
        
        # Server IPs for load balancing
        self.web_servers = ['10.0.0.101', '10.0.0.102', '10.0.0.103']
        self.current_server = 0  # Round-robin counter
    
    @set_ev_cls(ofp_event.EventOFPSwitchFeatures, CONFIG_DISPATCHER)
    def switch_features_handler(self, ev):
        "Install initial flow rules for NFV infrastructure"
        datapath = ev.msg.datapath
        dpid = datapath.id
        
        if dpid == 1:  # Classifier switch (s1)
            self.install_classifier_rules(datapath)
        elif dpid == 2:  # Firewall switch (s2)
            self.install_firewall_rules(datapath)
        elif dpid == 3:  # NAT switch (s3)
            self.install_nat_rules(datapath)
        elif dpid == 4:  # Load balancer switch (s4)
            self.install_load_balancer_rules(datapath)
        elif dpid == 5:  # Server switch (s5)
            self.install_server_rules(datapath)
    
    def install_classifier_rules(self, datapath):
        "Install traffic classification rules on s1"
        ofproto = datapath.ofproto
        parser = datapath.ofproto_parser
        
        # Allow ARP
        match = parser.OFPMatch(eth_type=0x0806)
        actions = [parser.OFPActionOutput(ofproto.OFPP_FLOOD)]
        self.add_flow(datapath, 100, match, actions)
        
        # Web traffic (TCP port 80, 443) -> Full service chain
        match = parser.OFPMatch(eth_type=0x0800, ip_proto=6, tcp_dst=(80, 443))
        actions = [parser.OFPActionOutput(2)]  # To firewall (service chain)
        self.add_flow(datapath, 50, match, actions)
        
        # VoIP traffic (UDP port 5060, 10000-20000) -> Firewall + NAT only
        match = parser.OFPMatch(eth_type=0x0800, ip_proto=17, 
                               udp_dst=(5060, 5060))
        actions = [parser.OFPActionOutput(2)]  # To firewall
        self.add_flow(datapath, 50, match, actions)
        
        # Management traffic (SSH) -> Firewall only, then bypass to servers
        match = parser.OFPMatch(eth_type=0x0800, ip_proto=6, tcp_dst=22)
        actions = [parser.OFPActionOutput(2)]  # To firewall
        self.add_flow(datapath, 50, match, actions)
        
        # Default: bypass service chain for other traffic
        match = parser.OFPMatch(eth_type=0x0800)
        actions = [parser.OFPActionOutput(6)]  # Direct to servers
        self.add_flow(datapath, 1, match, actions)
    
    def install_firewall_rules(self, datapath):
        "Install firewall rules on s2"
        ofproto = datapath.ofproto
        parser = datapath.ofproto_parser
        
        # Allow ARP
        match = parser.OFPMatch(eth_type=0x0806)
        actions = [parser.OFPActionOutput(ofproto.OFPP_FLOOD)]
        self.add_flow(datapath, 100, match, actions)
        
        # Forward all IP traffic to firewall VNF
        match = parser.OFPMatch(eth_type=0x0800)
        actions = [parser.OFPActionOutput(3)]  # To firewall host
        self.add_flow(datapath, 10, match, actions)
        
        # Return traffic from firewall to next hop (NAT)
        match = parser.OFPMatch(in_port=3)
        actions = [parser.OFPActionOutput(2)]  # To NAT switch
        self.add_flow(datapath, 10, match, actions)
    
    def install_nat_rules(self, datapath):
        "Install NAT rules on s3"
        ofproto = datapath.ofproto
        parser = datapath.ofproto_parser
        
        # Allow ARP
        match = parser.OFPMatch(eth_type=0x0806)
        actions = [parser.OFPActionOutput(ofproto.OFPP_FLOOD)]
        self.add_flow(datapath, 100, match, actions)
        
        # Forward traffic to NAT VNF
        match = parser.OFPMatch(eth_type=0x0800)
        actions = [parser.OFPActionOutput(3)]  # To NAT host
        self.add_flow(datapath, 10, match, actions)
        
        # Return traffic from NAT to next hop (load balancer)
        match = parser.OFPMatch(in_port=3)
        actions = [parser.OFPActionOutput(2)]  # To load balancer switch
        self.add_flow(datapath, 10, match, actions)
    
    def install_load_balancer_rules(self, datapath):
        "Install load balancing rules on s4"
        ofproto = datapath.ofproto
        parser = datapath.ofproto_parser
        
        # Allow ARP
        match = parser.OFPMatch(eth_type=0x0806)
        actions = [parser.OFPActionOutput(ofproto.OFPP_FLOOD)]
        self.add_flow(datapath, 100, match, actions)
        
        # Forward web traffic to load balancer VNF
        match = parser.OFPMatch(eth_type=0x0800, ip_proto=6, tcp_dst=(80, 443))
        actions = [parser.OFPActionOutput(3)]  # To load balancer host
        self.add_flow(datapath, 50, match, actions)
        
        # Bypass non-web traffic (e.g., VoIP, management)
        match = parser.OFPMatch(eth_type=0x0800)
        actions = [parser.OFPActionOutput(2)]  # Direct to servers
        self.add_flow(datapath, 1, match, actions)
        
        # Return traffic from load balancer to servers
        match = parser.OFPMatch(in_port=3)
        actions = [parser.OFPActionOutput(2)]  # To server switch
        self.add_flow(datapath, 10, match, actions)
    
    def install_server_rules(self, datapath):
        "Install server-facing rules on s5"
        ofproto = datapath.ofproto
        parser = datapath.ofproto_parser
        
        # Allow ARP
        match = parser.OFPMatch(eth_type=0x0806)
        actions = [parser.OFPActionOutput(ofproto.OFPP_FLOOD)]
        self.add_flow(datapath, 100, match, actions)
        
        # Round-robin load balancing for web servers
        # In a real implementation, this would be more sophisticated
        for i, server_ip in enumerate(self.web_servers):
            match = parser.OFPMatch(eth_type=0x0800, ipv4_dst=server_ip)
            actions = [parser.OFPActionOutput(i + 1)]  # Server ports start at 1
            self.add_flow(datapath, 10, match, actions)
        
        # Return traffic from servers
        match = parser.OFPMatch()
        actions = [parser.OFPActionOutput(6)]  # Back to classifier
        self.add_flow(datapath, 1, match, actions)
    
    @set_ev_cls(ofp_event.EventOFPPacketIn, MAIN_DISPATCHER)
    def packet_in_handler(self, ev):
        "Handle packets that don't match any flow rules"
        # In a full implementation, this would handle dynamic service chain
        # creation based on traffic analysis
        pass
    
    def add_flow(self, datapath, priority, match, actions):
        "Helper function to add flow entry"
        ofproto = datapath.ofproto
        parser = datapath.ofproto_parser
        
        inst = [parser.OFPInstructionActions(ofproto.OFPIT_APPLY_ACTIONS,
                                             actions)]
        mod = parser.OFPFlowMod(datapath=datapath, priority=priority,
                                match=match, instructions=inst)
        datapath.send_msg(mod)</code></pre>
                            
                            <h4>3. Understanding NFV Service Chains</h4>
                            <p>The NFV controller implements:</p>
                            <ul>
                                <li><strong>Traffic Classification:</strong> Identifies traffic types and assigns to appropriate service chains</li>
                                <li><strong>Service Chains:</strong> Different sequences of VNFs for different traffic types</li>
                                <li><strong>VNF Steering:</strong> Directs traffic through the appropriate VNFs in sequence</li>
                                <li><strong>Load Balancing:</strong> Distributes traffic across multiple server instances</li>
                            </ul>
                        </div>
                        
                        <div class="tab-content" data-tab="research">
                            <h3>Research Context and Extensions</h3>
                            
                            <h4>Current Research Directions</h4>
                            <ul>
                                <li><strong>Machine Learning for VNF Placement:</strong> Using ML to optimize where to place VNFs in the network based on traffic patterns and resource utilization</li>
                                <li><strong>Service Function Chaining (SFC):</strong> Standardized approaches for defining and managing service chains using protocols like NSH (Network Service Header)</li>
                                <li><strong>Performance Optimization:</strong> Reducing latency and improving throughput in NFV environments through smart placement and resource allocation</li>
                                <li><strong>Security Challenges:</strong> Protecting the virtualized infrastructure from attacks and ensuring VNF isolation</li>
                                <li><strong>5G Network Slicing:</strong> Using NFV to create virtual network slices with different characteristics for different applications</li>
                            </ul>
                            
                            <h4>Extensions for This Lab</h4>
                            <ol>
                                <li><strong>Dynamic Scaling:</strong> Implement automatic scaling of VNFs based on traffic load</li>
                                <li><strong>Health Monitoring:</strong> Add failure detection and automatic recovery for VNFs</li>
                                <li><strong>Quality of Service:</strong> Implement QoS policies for different service chains</li>
                                <li><strong>Northbound API:</strong> Create an API for dynamic service chain creation and management</li>
                                <li><strong>Service Mesh Integration:</strong> Integrate with service mesh technologies like Istio</li>
                            </ol>
                            
                            <h4>Research Challenges</h4>
                            <div class="warning-box">
                                <h4><i class="fas fa-exclamation-triangle mr-2"></i>Performance Overhead</h4>
                                <p>VNFs running as software on general-purpose servers can introduce significant performance overhead compared to dedicated hardware appliances. Research focuses on optimizing data plane performance through techniques like DPDK (Data Plane Development Kit) and SR-IOV (Single Root I/O Virtualization).</p>
                            </div>
                            
                            <div class="warning-box">
                                <h4><i class="fas fa-exclamation-triangle mr-2"></i>Orchestration Complexity</h4>
                                <p>Managing the lifecycle of VNFs and service chains across distributed infrastructure is complex. Research explores AI/ML-based orchestration and intent-based networking to simplify management.</p>
                            </div>
                            
                            <div class="info-box">
                                <h4><i class="fas fa-graduation-cap mr-2"></i>Further Reading</h4>
                                <ul>
                                    <li>ETSI NFV Industry Specification Group standards</li>
                                    <li>IETF SFC (Service Function Chaining) Working Group documents</li>
                                    <li>OpenSource MANO (OSM) project documentation</li>
                                    <li>OPNFV (Open Platform for NFV) resources</li>
                                    <li>Research papers on VNF placement and service chain optimization</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg mt-6">
                            <h4 class="flex items-center text-purple-800 dark:text-purple-200">
                                <i class="fas fa-flask mr-2"></i> Research Challenge
                            </h4>
                            <p class="text-purple-700 dark:text-purple-300">Try implementing a machine learning classifier to automatically detect traffic types and assign appropriate service chains without manual configuration. Use features like packet size, flow duration, and protocol information to classify traffic into categories like web, video, VoIP, or IoT.</p>
                        </div>
                    `
                };
                
                // Default content for other labs
                const defaultContent = `
                    <h3>Objective</h3>
                    <p>This lab will guide you through the concepts and practical implementation of ${labId}.</p>
                    
                    <h3>Requirements</h3>
                    <ul>
                        <li>Mininet VM</li>
                        <li>Ryu Controller</li>
                        <li>Basic knowledge of Python and networking</li>
                    </ul>
                    
                    <h3>Steps</h3>
                    <ol>
                        <li>Start the Mininet topology</li>
                        <li>Launch the Ryu controller</li>
                        <li>Implement the required functionality</li>
                        <li>Test and validate your implementation</li>
                    </ol>
                    
                    <h3>Example Code</h3>
                    <pre><code class="language-python"># Sample code for ${labId}
from ryu.base import app_manager
from ryu.controller import ofp_event
from ryu.controller.handler import CONFIG_DISPATCHER, MAIN_DISPATCHER
from ryu.controller.handler import set_ev_cls
from ryu.ofproto import ofproto_v1_3

class SampleApp(app_manager.RyuApp):
    OFP_VERSIONS = [ofproto_v1_3.OFP_VERSION]
    
    def __init__(self, *args, **kwargs):
        super(SampleApp, self).__init__(*args, **kwargs)
        
    @set_ev_cls(ofp_event.EventOFPSwitchFeatures, CONFIG_DISPATCHER)
    def switch_features_handler(self, ev):
        # Implementation goes here
        pass</code></pre>
                    
                    <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg mt-6">
                        <h4 class="flex items-center text-blue-800 dark:text-blue-200">
                            <i class="fas fa-lightbulb mr-2"></i> Tip
                        </h4>
                        <p class="text-blue-700 dark:text-blue-300">Use the "Explain" button if you need clarification on any concept in this lab.</p>
                    </div>
                `;
                
                return contentData[labId] || defaultContent;
            }
            
            // Get explanation for a lab
            function getExplanation(labId) {
                const explanations = {
                    'lab1-1': 'This lab guides you through installing and verifying your working environment. It ensures all tools (Mininet, Ryu) are in place and working correctly by performing a first simple test.',
                    'lab1-2': 'Mininet is a network emulator that allows you to build an entire network on your own PC. It serves as a sandbox for testing network configurations without expensive hardware.',
                    'lab1-3': 'Open vSwitch (OvS) is a software switch, the core component of our SDN network. This lab teaches you to give it manual commands to control packet processing.',
                    'lab2-1': 'MiniEdit is a graphical tool for creating network topologies. It allows you to visually design networks and export them as Mininet scripts.',
                    'lab2-2': 'This lab teaches you to write your first network topology directly in Python code, creating custom, reusable network designs.',
                    'lab3-1': 'This lab implements reactive L2 forwarding logic (MAC learning) in a Ryu controller, reproducing the function of a classic switch through OpenFlow programming.',
                    'lab5-1': 'A load balancer distributes traffic across multiple paths to avoid congestion and optimize performance, acting like a traffic cop for data.',
                    'lab6-4': 'This project implements a basic SDN Firewall using proactive flow rules to enforce security policies by allowing only specified traffic while dropping all other traffic.',
                    'lab7-1': 'Network Function Virtualization (NFV) decouples network functions from proprietary hardware, allowing them to run as software on commercial servers. This enables dynamic scaling and reduced costs.',
                    'lab7-2': 'P4 (Programming Protocol-Independent Packet Processors) enables programming the data plane of switches at the protocol level, allowing custom packet processing beyond OpenFlow capabilities.',
                    'lab7-3': 'Intent-Based Networking translates business objectives into network policies automatically, reducing manual configuration and improving agility.',
                    'lab7-4': 'Machine learning can classify network traffic patterns to automatically apply appropriate policies and detect anomalies in real-time.',
                    'lab7-5': 'SD-WAN uses SDN principles to manage wide area networks, optimizing application performance and reducing costs compared to traditional WAN technologies.',
                    'lab7-6': 'Time-Sensitive Networking (TSN) provides deterministic latency and reliability for critical applications like industrial automation and automotive systems.'
                };
                
                return explanations[labId] || "No predefined explanation is available for this laboratory. Please refer to the lab instructions and documentation.";
            }
            
            // Initialize the application
            init();
        });
    </script>
</body>
</html>